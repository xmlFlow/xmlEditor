(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{7946:function(e,t,a){Promise.resolve().then(a.bind(a,4420))},4420:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eK}});var s=a(7437),n=a(2265);let r=[{name:"Root Element",type:"error",check:e=>e.querySelector("article")?null:"Missing required root <article> element - this is not a valid JATS document"},{name:"DTD Version",type:"warning",check:e=>{let t=e.querySelector("article");if(!t)return null;let a=t.getAttribute("dtd-version"),s=["3.0","0.4","1.0","1.1d1","1.1d2","1.1d3","1.1","1.2d1","1.2d2","1.2","1.3d1","1.3d2","1.3"];return a?s.includes(a)?null:'Invalid @dtd-version "'.concat(a,'". Valid versions: ').concat(s.join(", ")):"Missing @dtd-version attribute on <article> element - recommended for proper JATS identification"}},{name:"Article Type",type:"warning",check:e=>{let t=e.querySelector("article");return t?t.getAttribute("article-type")?null:"Missing @article-type attribute on <article> element - recommended for proper document classification":null}},{name:"Front Matter",type:"error",check:e=>{let t=e.querySelector("article > front"),a=e.querySelector("article > front-stub");return t||a?null:"Missing required <front> or <front-stub> element - JATS requires article metadata"}},{name:"Journal Metadata",type:"error",check:e=>{let t=e.querySelector("article > front");return t?t.querySelector("journal-meta")?null:"Missing required <journal-meta> element in <front> - JATS requires journal information":null}},{name:"Article Metadata",type:"error",check:e=>{let t=e.querySelector("article > front");return t?t.querySelector("article-meta")?null:"Missing required <article-meta> element in <front> - JATS requires article metadata":null}},{name:"Title Group",type:"error",check:e=>{let t=e.querySelector("article-meta");if(!t)return null;let a=t.querySelector("title-group");return a?a.querySelector("article-title")?null:"Missing required <article-title> element in <title-group>":"Missing required <title-group> element in <article-meta>"}},{name:"Language Declaration",type:"warning",check:e=>{let t=e.querySelector("article");return t?t.getAttribute("xml:lang")?null:"Missing @xml:lang attribute on <article> element - recommended for internationalization":null}},{name:"JATS Namespaces",type:"warning",check:e=>{let t=e.querySelector("article");if(!t)return null;let a=[];return(t.hasAttribute("xmlns:xlink")||t.getAttribute("xmlns:xlink")||a.push("Missing XLink namespace declaration"),!e.querySelector("math")||t.hasAttribute("xmlns:mml")||t.getAttribute("xmlns:mml")||a.push("MathML elements found but missing MathML namespace declaration"),a.length>0)?"Namespace issues: ".concat(a.join(", ")):null}},{name:"Reference Structure",type:"warning",check:e=>{let t=e.querySelectorAll("ref"),a=[];return(Array.from(t).forEach((e,t)=>{e.getAttribute("id")||a.push("Reference ".concat(t+1," missing @id attribute"));let s=e.querySelector("element-citation"),n=e.querySelector("mixed-citation");s||n||a.push("Reference ".concat(t+1," missing citation content (<element-citation> or <mixed-citation>)")),s&&!s.getAttribute("publication-type")&&a.push("Reference ".concat(t+1," <element-citation> missing @publication-type"))}),a.length>0)?a.join("; "):null}},{name:"Cross-References",type:"warning",check:e=>{let t=e.querySelectorAll("xref"),a=[];return(Array.from(t).forEach((t,s)=>{let n=t.getAttribute("rid"),r=t.getAttribute("ref-type");if(!n){a.push("Cross-reference ".concat(s+1," missing @rid attribute"));return}if(!r){a.push("Cross-reference ".concat(s+1," missing @ref-type attribute"));return}e.getElementById(n)||a.push("Cross-reference ".concat(s+1,' points to non-existent element with id "').concat(n,'"'))}),a.length>0)?a.join("; "):null}},{name:"Section Structure",type:"warning",check:e=>{let t=e.querySelectorAll("sec"),a=[];return(Array.from(t).forEach((e,t)=>{var s;e.querySelector(":scope > title")||(null===(s=e.parentElement)||void 0===s?void 0:s.tagName)!=="body"||a.push("Top-level section ".concat(t+1," missing <title> element"))}),a.length>0)?a.join("; "):null}},{name:"Figures and Tables",type:"warning",check:e=>{let t=[];return(Array.from(e.querySelectorAll("fig")).forEach((e,a)=>{e.getAttribute("id")||t.push("Figure ".concat(a+1," missing @id attribute"));let s=e.querySelector("label"),n=e.querySelector("caption");s||n||t.push("Figure ".concat(a+1," missing both <label> and <caption>"))}),Array.from(e.querySelectorAll("table-wrap")).forEach((e,a)=>{e.getAttribute("id")||t.push("Table ".concat(a+1," missing @id attribute")),e.querySelector("table")||t.push("Table wrap ".concat(a+1," missing <table> element"))}),t.length>0)?t.join("; "):null}}];var l=a(8736),i=a(4630),o=a(2489),c=a(7689),d=a(2381),u=a(9174);function m(e){let{showUpload:t,onToggleUpload:a,onOpenFrontMatter:n}=e;return(0,s.jsx)("header",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l.Z,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"JATS XML Editor"}),(0,s.jsx)(u.C,{variant:"secondary",className:"ml-2",children:"v1.0"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[n&&(0,s.jsxs)(d.z,{variant:"outline",size:"sm",onClick:n,children:[(0,s.jsx)(i.Z,{className:"h-4 w-4 mr-1"}),"Front Matter"]}),(0,s.jsxs)(d.z,{variant:t?"default":"outline",size:"sm",onClick:a,children:[t?(0,s.jsx)(o.Z,{className:"h-4 w-4 mr-1"}):(0,s.jsx)(c.Z,{className:"h-4 w-4 mr-1"}),t?"Close Upload":"Upload JATS"]})]})]})})})}var h=a(7265),p=a(9820),x=a(3448);let g=n.forwardRef((e,t)=>{let{className:a,variant:n="default",...r}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,x.cn)("relative w-full rounded-lg border p-4","default"===n&&"bg-white text-gray-950","destructive"===n&&"border-red-200 text-red-800 bg-red-50",a),...r})});g.displayName="Alert";let f=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,x.cn)("text-sm",a),...n})});f.displayName="AlertDescription";var b=a(5302),y=a(2252);function v(e){let{accept:t=".xml,.jats",maxSize:a=10485760,onFileSelect:r,onFileRead:i,className:u,disabled:m=!1}=e,[h,v]=(0,n.useState)(!1),[j,N]=(0,n.useState)(!1),[w,C]=(0,n.useState)(null),[S,A]=(0,n.useState)(null),k=(0,n.useCallback)(e=>{if(C(null),e.size>a){C("File size exceeds ".concat(Math.round(a/1024/1024),"MB limit"));return}if(!t.split(",").map(e=>e.trim()).some(t=>t.startsWith(".")?e.name.toLowerCase().endsWith(t):e.type===t)){C("Invalid file type. Accepted types: ".concat(t));return}A(e),r(e),N(!0);let s=new FileReader;s.onload=t=>{var a;i(null===(a=t.target)||void 0===a?void 0:a.result,e),N(!1)},s.onerror=()=>{C("Failed to read file"),N(!1)},s.readAsText(e)},[t,a,r,i]),T=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?v(!0):"dragleave"===e.type&&v(!1)},[]),q=(0,n.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),v(!1),m)return;let t=Array.from(e.dataTransfer.files);t.length>0&&k(t[0])},[m,k]),L=(0,n.useCallback)(e=>{let t=e.target.files;t&&t.length>0&&k(t[0])},[k]),E=(0,n.useCallback)(()=>{A(null),C(null)},[]);return(0,s.jsxs)(p.Zb,{className:(0,x.cn)("relative",u),children:[(0,s.jsxs)(p.Ol,{className:"pb-3",children:[(0,s.jsxs)(p.ll,{className:"text-sm flex items-center",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Upload JATS File"]}),(0,s.jsx)(p.SZ,{children:"Upload an existing JATS XML file to edit"})]}),(0,s.jsxs)(p.aY,{children:[(0,s.jsxs)("div",{className:(0,x.cn)("relative border-2 border-dashed rounded-lg p-6 text-center transition-colors",h&&!m?"border-blue-500 bg-blue-50":"border-gray-300",m?"opacity-50 cursor-not-allowed":"cursor-pointer hover:border-gray-400"),onDragEnter:T,onDragLeave:T,onDragOver:T,onDrop:q,onClick:()=>{if(!m){var e;null===(e=document.getElementById("file-input"))||void 0===e||e.click()}},children:[(0,s.jsx)("input",{id:"file-input",type:"file",accept:t,onChange:L,className:"hidden",disabled:m}),j?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-2"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Reading file..."})]}):S?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(b.Z,{className:"h-8 w-8 text-green-500 mb-2"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:S.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mb-2",children:[Math.round(S.size/1024)," KB"]}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),E()},children:[(0,s.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),"Clear"]})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(l.Z,{className:"h-8 w-8 text-gray-400 mb-2"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:"Drop your JATS XML file here, or click to browse"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Supports .xml and .jats files up to ",Math.round(a/1024/1024),"MB"]})]})]}),w&&(0,s.jsxs)(g,{variant:"destructive",className:"mt-3",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4"}),(0,s.jsx)(f,{children:w})]})]})]})}var j=a(3245),N=a(2135),w=a(875),C=a(4935),S=a(5805),A=a(1769),k=a(3417);function T(e){let{onFileProcessed:t,disabled:a=!1}=e,[l,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),x=(0,n.useCallback)(async(e,a)=>{c(!0);try{let a=function(e){let t={isValid:!1,content:"",metadata:{},references:[],footnotes:[],errors:[],warnings:[],debugInfo:{xmlPreview:e.substring(0,500)+(e.length>500?"...":""),parseSteps:[],elementCounts:{},jatsCompliance:{isJATS:!1,violations:[]}}};try{t.debugInfo.parseSteps.push("Starting enhanced JATS parsing with RNG compliance check...");let a=new DOMParser().parseFromString(e,"text/xml");t.debugInfo.parseSteps.push("XML parsed successfully");let s=a.querySelector("parsererror");if(s)return t.errors.push("XML parsing error: ".concat(s.textContent)),t.debugInfo.parseSteps.push("XML parsing failed"),t;t.debugInfo.parseSteps.push("Running JATS compliance validation...");let n=!0;if(r.forEach(e=>{let s=e.check(a);s&&("error"===e.type?(t.errors.push("".concat(e.name,": ").concat(s)),t.debugInfo.jatsCompliance.violations.push(s),"Root Element"===e.name&&(n=!1)):(t.warnings.push("".concat(e.name,": ").concat(s)),t.debugInfo.jatsCompliance.violations.push(s)))}),t.debugInfo.jatsCompliance.isJATS=n,!n)return t.debugInfo.parseSteps.push("Document is not valid JATS - stopping processing"),t;let l=a.querySelector("article");if(l){let e=l.getAttribute("dtd-version"),a=l.getAttribute("article-type");t.debugInfo.jatsCompliance.version=e||"unknown",t.debugInfo.jatsCompliance.schemaType="Journal Publishing DTD",t.metadata.dtdVersion=e||void 0,t.metadata.articleType=a||void 0,t.debugInfo.parseSteps.push("JATS version: ".concat(e||"not specified")),t.debugInfo.parseSteps.push("Article type: ".concat(a||"not specified"))}let i=a.querySelectorAll("*");t.debugInfo.elementCounts.total=i.length,t.debugInfo.elementCounts.sections=a.querySelectorAll("sec").length,t.debugInfo.elementCounts.paragraphs=a.querySelectorAll("p").length,t.debugInfo.elementCounts.references=a.querySelectorAll("ref").length,t.debugInfo.elementCounts.footnotes=a.querySelectorAll("fn").length,t.debugInfo.elementCounts.figures=a.querySelectorAll("fig").length,t.debugInfo.elementCounts.tables=a.querySelectorAll("table-wrap").length,t.debugInfo.elementCounts.formulas=a.querySelectorAll("disp-formula").length,t.debugInfo.parseSteps.push("Element counting completed");try{let e=a.querySelector("front"),s=a.querySelector("front-stub"),n=e||s;n?(t.debugInfo.parseSteps.push("Processing metadata with enhanced extraction..."),function(e,t){let a=e.querySelector("journal-meta");if(a){let e=a.querySelector("journal-title-group journal-title, journal-title"),s=a.querySelector("abbrev-journal-title"),n=a.querySelector("issn"),r=a.querySelector("publisher-name"),l=a.querySelector("publisher-loc");e&&(t.metadata.journal=e.textContent||""),s&&(t.metadata.journalAbbrev=s.textContent||""),n&&(t.metadata.issn=n.textContent||"",t.metadata.issnType=n.getAttribute("pub-type")||"print"),r&&(t.metadata.publisher=r.textContent||""),l&&(t.metadata.publisherLocation=l.textContent||"")}let s=e.querySelector("article-meta");if(s){var n,r,l,i,o,c,d,u,m,h,p,x,g;let e=s.querySelector("title-group");if(e){let a=e.querySelector("article-title"),s=e.querySelector("subtitle");a&&(t.metadata.title=a.textContent||""),s&&(t.metadata.subtitle=s.textContent||"")}let a=s.querySelector('article-id[pub-id-type="doi"]'),f=s.querySelector('article-id[pub-id-type="publisher-id"]');a&&(t.metadata.doi=a.textContent||""),f&&(t.metadata.articleId=f.textContent||"");let b=s.querySelector("volume"),y=s.querySelector("issue"),v=s.querySelector("fpage"),j=s.querySelector("lpage");b&&(t.metadata.volume=b.textContent||""),y&&(t.metadata.issue=y.textContent||""),v&&(t.metadata.fpage=v.textContent||""),j&&(t.metadata.lpage=j.textContent||"");let N=s.querySelector("pub-date");if(N){let e=null===(n=N.querySelector("year"))||void 0===n?void 0:n.textContent,a=null===(r=N.querySelector("month"))||void 0===r?void 0:r.textContent,s=null===(l=N.querySelector("day"))||void 0===l?void 0:l.textContent;e&&(t.metadata.pubYear=e),a&&(t.metadata.pubMonth=a),s&&(t.metadata.pubDay=s)}let w=s.querySelector("contrib-group");if(w){let e=w.querySelectorAll('contrib[contrib-type="author"]');t.metadata.authors=Array.from(e).map(e=>{var t,a,s,n;let r=e.querySelector("name"),l=e.querySelector("email"),i=e.querySelector('contrib-id[contrib-id-type="orcid"]'),o=e.querySelectorAll('xref[ref-type="aff"]'),c="yes"===e.getAttribute("corresp");return{surname:(null==r?void 0:null===(t=r.querySelector("surname"))||void 0===t?void 0:t.textContent)||"",givenNames:(null==r?void 0:null===(a=r.querySelector("given-names"))||void 0===a?void 0:a.textContent)||"",prefix:null==r?void 0:null===(s=r.querySelector("prefix"))||void 0===s?void 0:s.textContent,suffix:null==r?void 0:null===(n=r.querySelector("suffix"))||void 0===n?void 0:n.textContent,email:null==l?void 0:l.textContent,orcid:null==i?void 0:i.textContent,affiliations:Array.from(o).map(e=>e.getAttribute("rid")||""),corresp:c}}).filter(e=>e.surname||e.givenNames)}let C=s.querySelectorAll("aff");t.metadata.affiliations=Array.from(C).map(e=>{var t,a,s,n;let r=e.getAttribute("id")||"",l=(null===(t=e.querySelector("institution"))||void 0===t?void 0:t.textContent)||"",i=null===(a=e.querySelector('[content-type="department"]'))||void 0===a?void 0:a.textContent,o=null===(s=e.querySelector("city"))||void 0===s?void 0:s.textContent;return{id:r,institution:l,department:i,city:o,country:null===(n=e.querySelector("country"))||void 0===n?void 0:n.textContent}});let S=s.querySelector("abstract p, abstract");S&&(t.metadata.abstract=S.textContent||"");let A=s.querySelectorAll("kwd-group kwd");A.length>0&&(t.metadata.keywords=Array.from(A).map(e=>e.textContent||"").filter(Boolean));let k=s.querySelector("funding-statement");k&&(t.metadata.fundingStatement=k.textContent||"");let T=s.querySelector("permissions");if(T){let e=T.querySelector("copyright-year"),a=T.querySelector("copyright-holder"),s=T.querySelector("copyright-statement"),n=T.querySelector("license license-p"),r=T.querySelector("license");e&&(t.metadata.copyrightYear=e.textContent||""),a&&(t.metadata.copyrightHolder=a.textContent||""),s&&(t.metadata.copyrightStatement=s.textContent||""),n&&(t.metadata.license=n.textContent||""),r&&(t.metadata.licenseUrl=r.getAttribute("xlink:href")||"")}let q=s.querySelector("history");if(q){let e=q.querySelector('date[date-type="received"]'),a=q.querySelector('date[date-type="accepted"]');if(e){let a=null===(i=e.querySelector("year"))||void 0===i?void 0:i.textContent,s=null===(c=e.querySelector("month"))||void 0===c?void 0:null===(o=c.textContent)||void 0===o?void 0:o.padStart(2,"0"),n=null===(u=e.querySelector("day"))||void 0===u?void 0:null===(d=u.textContent)||void 0===d?void 0:d.padStart(2,"0");a&&s&&n&&(t.metadata.receivedDate="".concat(a,"-").concat(s,"-").concat(n))}if(a){let e=null===(m=a.querySelector("year"))||void 0===m?void 0:m.textContent,s=null===(p=a.querySelector("month"))||void 0===p?void 0:null===(h=p.textContent)||void 0===h?void 0:h.padStart(2,"0"),n=null===(g=a.querySelector("day"))||void 0===g?void 0:null===(x=g.textContent)||void 0===x?void 0:x.padStart(2,"0");e&&s&&n&&(t.metadata.acceptedDate="".concat(e,"-").concat(s,"-").concat(n))}}}}(n,t),t.debugInfo.parseSteps.push("Enhanced metadata extraction completed")):t.warnings.push("No front matter or front-stub found")}catch(e){t.errors.push("Metadata extraction error: ".concat(e)),t.debugInfo.parseSteps.push("Metadata extraction failed: ".concat(e))}try{let e=a.querySelector("body");e?(t.debugInfo.parseSteps.push("Processing body content..."),t.content=function(e,t){let a="";try{t.push("Converting JATS body to HTML...");let s=e=>{let a=e.tagName.toLowerCase();try{switch(a){case"sec":let t=e.querySelector(":scope > title"),d="",h=n(e);return t&&(d+="<h".concat(h,">").concat(t.textContent,"</h").concat(h,">")),Array.from(e.children).forEach(e=>{"title"!==e.tagName.toLowerCase()&&(d+=s(e))}),d;case"p":return l(e);case"title":return"";case"table-wrap":return i(e);case"fig":return o(e);case"disp-formula":return c(e);case"list":return u(e);case"def-list":return m(e);case"disp-quote":return"<blockquote>".concat(l(e),"</blockquote>");case"boxed-text":return'<div class="boxed-text">'.concat(r(e),"</div>");default:return r(e)}}catch(e){return t.push("Error processing node ".concat(a,": ").concat(e)),"<p>Error processing ".concat(a," element</p>")}},n=e=>{let t=1,a=e.parentElement;for(;a&&"body"!==a.tagName;)"sec"===a.tagName.toLowerCase()&&t++,a=a.parentElement;return Math.min(t,6)},r=e=>{let t="";return Array.from(e.children).forEach(e=>{t+=s(e)}),t},l=e=>{let a="";try{Array.from(e.childNodes).forEach(e=>{if(e.nodeType===Node.TEXT_NODE)a+=e.textContent;else if(e.nodeType===Node.ELEMENT_NODE)switch(e.tagName.toLowerCase()){case"bold":a+="<strong>".concat(e.textContent,"</strong>");break;case"italic":a+="<em>".concat(e.textContent,"</em>");break;case"underline":a+="<u>".concat(e.textContent,"</u>");break;case"sup":a+="<sup>".concat(e.textContent,"</sup>");break;case"sub":a+="<sub>".concat(e.textContent,"</sub>");break;case"monospace":a+="<code>".concat(e.textContent,"</code>");break;case"xref":let t=e.getAttribute("ref-type"),s=e.getAttribute("rid");"bibr"===t?a+='<sup data-citation="" data-id="'.concat(s,'" data-type="bibr">').concat(e.textContent,"</sup>"):"fn"===t?a+='<span class="footnote-linked-text" data-citation="" data-id="'.concat(s,'" data-type="fn">').concat(e.textContent,"</span>"):a+='<a href="#'.concat(s,'" data-ref-type="').concat(t,'">').concat(e.textContent,"</a>");break;case"ext-link":let n=e.getAttribute("xlink:href")||e.getAttribute("href");a+='<a href="'.concat(n,'" target="_blank">').concat(e.textContent,"</a>");break;case"inline-formula":a+=d(e);break;default:a+=e.textContent}})}catch(s){t.push("Error processing text content: ".concat(s)),a=e.textContent||""}return"<p>".concat(a,"</p>")},i=e=>{try{let t=e.querySelector("table");if(!t)return"";let a=e.querySelector("label"),s=e.querySelector("caption"),n="";(a||s)&&(n+="<figure>",a&&(n+='<div class="table-label">'.concat(a.textContent,"</div>")),s&&(n+="<figcaption>".concat(s.textContent,"</figcaption>"))),n+="<table>";let r=t.querySelector("thead");if(r){n+="<thead>";let e=r.querySelectorAll("tr");Array.from(e).forEach(e=>{n+="<tr>";let t=e.querySelectorAll("th, td");Array.from(t).forEach(e=>{let t=e.getAttribute("colspan"),a=e.getAttribute("rowspan"),s=[];t&&s.push('colspan="'.concat(t,'"')),a&&s.push('rowspan="'.concat(a,'"')),n+="<th".concat(s.length?" "+s.join(" "):"",">").concat(e.textContent,"</th>")}),n+="</tr>"}),n+="</thead>"}let l=t.querySelector("tbody");if(l){n+="<tbody>";let e=l.querySelectorAll("tr");Array.from(e).forEach(e=>{n+="<tr>";let t=e.querySelectorAll("td, th");Array.from(t).forEach(e=>{let t=e.getAttribute("colspan"),a=e.getAttribute("rowspan"),s=[];t&&s.push('colspan="'.concat(t,'"')),a&&s.push('rowspan="'.concat(a,'"')),n+="<td".concat(s.length?" "+s.join(" "):"",">").concat(e.textContent,"</td>")}),n+="</tr>"}),n+="</tbody>"}return n+="</table>",(a||s)&&(n+="</figure>"),n}catch(e){return t.push("Error processing table: ".concat(e)),"<p>Error processing table</p>"}},o=e=>{try{let t=e.querySelector("label"),a=e.querySelector("caption"),s=e.querySelector("graphic"),n="<figure>";if(s){let e=s.getAttribute("xlink:href")||s.getAttribute("href"),t=(null==a?void 0:a.textContent)||"Figure";e&&(n+='<img src="'.concat(e,'" alt="').concat(t,'" />'))}return t&&(n+='<div class="figure-label">'.concat(t.textContent,"</div>")),a&&(n+="<figcaption>".concat(a.textContent,"</figcaption>")),n+="</figure>"}catch(e){return t.push("Error processing figure: ".concat(e)),"<p>Error processing figure</p>"}},c=e=>{try{let t=e.getAttribute("id")||"",a=e.querySelector("label"),s=e.querySelector("alternatives")||e,n=s.querySelector("math, mml\\:math"),r=n?n.outerHTML:"",l=s.querySelector("tex-math"),i=l&&l.textContent||"",o=e.querySelector("alt-text"),c=o&&o.textContent||"",d=e=>{let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},u=["data-display-formula",t?'data-id="'.concat(t,'"'):"",r?'data-mathml="'.concat(d(r),'"'):"",i?'data-latex="'.concat(d(i),'"'):"",a?'data-label="'.concat(d(a.textContent||""),'"'):"",c?'data-alt-text="'.concat(d(c),'"'):""].filter(Boolean).join(" ");return"<div ".concat(u,"></div>")}catch(e){return t.push("Error processing formula: ".concat(e)),"<p>Error processing formula</p>"}},d=e=>{try{let t=e.getAttribute("id")||"",a=e.querySelector("alternatives")||e,s=a.querySelector("math, mml\\:math"),n=s?s.outerHTML:"",r=a.querySelector("tex-math"),l=r&&r.textContent||"",i=e.querySelector("alt-text"),o=i&&i.textContent||"",c=e=>{let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},d=["data-inline-formula",t?'data-id="'.concat(t,'"'):"",n?'data-mathml="'.concat(c(n),'"'):"",l?'data-latex="'.concat(c(l),'"'):"",o?'data-alt-text="'.concat(c(o),'"'):""].filter(Boolean).join(" ");return"<span ".concat(d,"></span>")}catch(a){return t.push("Error processing inline formula: ".concat(a)),e.textContent||""}},u=e=>{try{let t=e.getAttribute("list-type")||"bullet",a="order"===t?"ol":"ul",n="<".concat(a,">"),r=e.querySelectorAll("list-item");return Array.from(r).forEach(e=>{n+="<li>",Array.from(e.children).forEach(e=>{"p"===e.tagName.toLowerCase()?n+=e.textContent:n+=s(e)}),n+="</li>"}),n+="</".concat(a,">")}catch(e){return t.push("Error processing list: ".concat(e)),"<p>Error processing list</p>"}},m=e=>{try{let t="<dl>",a=e.querySelectorAll("def-item");return Array.from(a).forEach(e=>{let a=e.querySelector("term"),s=e.querySelector("def");a&&(t+="<dt>".concat(a.textContent,"</dt>")),s&&(t+="<dd>".concat(s.textContent,"</dd>"))}),t+="</dl>"}catch(e){return t.push("Error processing definition list: ".concat(e)),"<p>Error processing definition list</p>"}},h=Array.from(e.children);return t.push("Processing ".concat(h.length," body elements...")),h.forEach((e,n)=>{try{a+=s(e)}catch(e){t.push("Error processing child element ".concat(n,": ").concat(e)),a+="<p>Error processing element ".concat(n,"</p>")}}),t.push("HTML conversion completed (".concat(a.length," characters)")),a}catch(e){return t.push("Fatal conversion error: ".concat(e)),"<p>Error converting JATS to HTML: ".concat(e,"</p>")}}(e,t.debugInfo.parseSteps),t.debugInfo.parseSteps.push("Body content converted (".concat(t.content.length," chars)"))):(t.warnings.push("No body content found"),t.debugInfo.parseSteps.push("No body element found"))}catch(e){t.errors.push("Body processing error: ".concat(e)),t.debugInfo.parseSteps.push("Body processing failed: ".concat(e))}try{let e=a.querySelectorAll("ref");t.debugInfo.parseSteps.push("Processing ".concat(e.length," references...")),Array.from(e).forEach((e,a)=>{try{let a=e.getAttribute("id")||"ref".concat(t.references.length+1),d=e.querySelector("element-citation"),u=e.querySelector("mixed-citation");if(d){var s,n,r,l,i,o,c;let e=Array.from(d.querySelectorAll("name")).map(e=>{var t,a;return{surname:(null===(t=e.querySelector("surname"))||void 0===t?void 0:t.textContent)||"",givenNames:(null===(a=e.querySelector("given-names"))||void 0===a?void 0:a.textContent)||""}}).filter(e=>e.surname||e.givenNames);t.references.push({id:a,type:"element-citation",publicationType:d.getAttribute("publication-type")||"journal",authors:e,title:(null===(s=d.querySelector("article-title"))||void 0===s?void 0:s.textContent)||"",source:(null===(n=d.querySelector("source"))||void 0===n?void 0:n.textContent)||"",year:(null===(r=d.querySelector("year"))||void 0===r?void 0:r.textContent)||"",volume:(null===(l=d.querySelector("volume"))||void 0===l?void 0:l.textContent)||"",issue:(null===(i=d.querySelector("issue"))||void 0===i?void 0:i.textContent)||"",fpage:(null===(o=d.querySelector("fpage"))||void 0===o?void 0:o.textContent)||"",lpage:(null===(c=d.querySelector("lpage"))||void 0===c?void 0:c.textContent)||""})}else u&&t.references.push({id:a,type:"mixed-citation",publicationType:u.getAttribute("publication-type")||"journal",content:u.textContent||""})}catch(e){t.warnings.push("Reference ".concat(a+1," processing error: ").concat(e))}}),t.debugInfo.parseSteps.push("".concat(t.references.length," references processed"))}catch(e){t.errors.push("References processing error: ".concat(e)),t.debugInfo.parseSteps.push("References processing failed: ".concat(e))}try{let e=a.querySelectorAll("fn");t.debugInfo.parseSteps.push("Processing ".concat(e.length," footnotes...")),Array.from(e).forEach((e,a)=>{try{var s;let a=e.getAttribute("id")||"fn".concat(t.footnotes.length+1),n=(null===(s=e.querySelector("p"))||void 0===s?void 0:s.textContent)||e.textContent||"";t.footnotes.push({id:a,content:n})}catch(e){t.warnings.push("Footnote ".concat(a+1," processing error: ").concat(e))}}),t.debugInfo.parseSteps.push("".concat(t.footnotes.length," footnotes processed"))}catch(e){t.errors.push("Footnotes processing error: ".concat(e)),t.debugInfo.parseSteps.push("Footnotes processing failed: ".concat(e))}return t.isValid=0===t.errors.length&&n,t.debugInfo.parseSteps.push("Parsing completed. Valid JATS: ".concat(t.isValid)),t.debugInfo.parseSteps.push("JATS compliance: ".concat(t.debugInfo.jatsCompliance.isJATS)),t}catch(e){return t.errors.push("Parse error: ".concat(e)),t.debugInfo.parseSteps.push("Fatal error: ".concat(e)),t}}(e);i(a),a.isValid&&t({references:a.references,footnotes:a.footnotes,metadata:a.metadata,content:a.content})}catch(t){i({isValid:!1,content:"",metadata:{},references:[],footnotes:[],errors:["Failed to process file: ".concat(t)],warnings:[],debugInfo:{xmlPreview:e.substring(0,500),parseSteps:["Fatal error: ".concat(t)],elementCounts:{},jatsCompliance:{isJATS:!1,version:void 0,schemaType:void 0,violations:[]}}})}finally{c(!1)}},[t]),T=(0,n.useCallback)(e=>{i(null),h(!1)},[]),q=(0,n.useCallback)(()=>{l&&!l.isValid&&t({content:l.content,references:l.references,footnotes:l.footnotes,metadata:l.metadata})},[l,t]),L=(0,n.useCallback)(()=>{h(!m)},[m]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(v,{accept:".xml,.jats",maxSize:10485760,onFileSelect:T,onFileRead:x,disabled:a||o}),l&&(0,s.jsxs)(p.Zb,{children:[(0,s.jsx)(p.Ol,{className:"pb-3",children:(0,s.jsxs)(p.ll,{className:"text-sm flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[l.isValid?(0,s.jsx)(b.Z,{className:"h-4 w-4 text-green-500 mr-2"}):(0,s.jsx)(y.Z,{className:"h-4 w-4 text-red-500 mr-2"}),"Parse Results"]}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:L,className:"ml-2",children:[(0,s.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),"Debug",m?(0,s.jsx)(N.Z,{className:"h-3 w-3 ml-1"}):(0,s.jsx)(w.Z,{className:"h-3 w-3 ml-1"})]})]})}),(0,s.jsxs)(p.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Status"}),(0,s.jsx)(u.C,{variant:l.isValid?"default":"destructive",children:l.isValid?"Valid":"Invalid"})]}),m&&l.debugInfo&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,s.jsxs)("h4",{className:"text-sm font-medium mb-2 flex items-center",children:[(0,s.jsx)(C.Z,{className:"h-3 w-3 mr-1"}),"XML Preview"]}),(0,s.jsx)("pre",{className:"text-xs text-gray-600 overflow-x-auto whitespace-pre-wrap",children:l.debugInfo.xmlPreview})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Element Counts"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(l.debugInfo.elementCounts).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"capitalize",children:[t,":"]}),(0,s.jsx)("span",{className:"font-medium",children:a})]},t)})})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Parse Steps"}),(0,s.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:l.debugInfo.parseSteps.map((e,t)=>(0,s.jsxs)("div",{className:"text-xs text-gray-600",children:[t+1,". ",e]},t))})]})]}),l.metadata.title&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-1",children:"Title"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:l.metadata.title})]}),l.metadata.authors&&l.metadata.authors.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-medium mb-1 flex items-center",children:[(0,s.jsx)(S.Z,{className:"h-3 w-3 mr-1"}),"Authors"]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:l.metadata.authors.map((e,t)=>(0,s.jsxs)(u.C,{variant:"secondary",children:[e.givenNames," ",e.surname]},t))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-600 flex items-center",children:[(0,s.jsx)(A.Z,{className:"h-3 w-3 mr-1"}),"References"]}),(0,s.jsx)(u.C,{variant:"secondary",children:l.references.length})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-600 flex items-center",children:[(0,s.jsx)(k.Z,{className:"h-3 w-3 mr-1"}),"Footnotes"]}),(0,s.jsx)(u.C,{variant:"secondary",children:l.footnotes.length})]})]}),l.errors.length>0&&(0,s.jsxs)(g,{variant:"destructive",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4"}),(0,s.jsxs)(f,{children:[(0,s.jsxs)("div",{className:"font-medium mb-1",children:["Errors (",l.errors.length,")"]}),(0,s.jsx)("ul",{className:"text-sm space-y-1",children:l.errors.map((e,t)=>(0,s.jsxs)("li",{className:"font-mono text-xs",children:["• ",e]},t))})]})]}),l.warnings.length>0&&(0,s.jsxs)(g,{children:[(0,s.jsx)(y.Z,{className:"h-4 w-4"}),(0,s.jsxs)(f,{children:[(0,s.jsxs)("div",{className:"font-medium mb-1",children:["Warnings (",l.warnings.length,")"]}),(0,s.jsx)("ul",{className:"text-sm space-y-1",children:l.warnings.map((e,t)=>(0,s.jsxs)("li",{className:"font-mono text-xs",children:["• ",e]},t))})]})]}),!l.isValid&&l.content&&(0,s.jsx)(d.z,{variant:"outline",size:"sm",onClick:q,className:"w-full",children:"Load Content Despite Errors"})]})]})]})}function q(e){let{onFileProcessed:t,onClose:a}=e;return(0,s.jsxs)(p.Zb,{className:"mb-6",children:[(0,s.jsxs)(p.Ol,{children:[(0,s.jsxs)(p.ll,{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(h.Z,{className:"h-5 w-5 mr-2"}),"Upload JATS File"]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:a,children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})]}),(0,s.jsx)(p.SZ,{children:"Upload an existing JATS XML file to continue editing"})]}),(0,s.jsx)(p.aY,{children:(0,s.jsx)(T,{onFileProcessed:t,disabled:!1})})]})}var L=a(5015),E=a(6218),M=a(6379),D=a(4110),z=a(6750),I=a(7966),Z=a(3676),F=a(4725);let H=F.vc.create({name:"citation",addOptions:()=>({HTMLAttributes:{}}),addAttributes:()=>({id:{default:null},type:{default:"bibr"}}),parseHTML:()=>[{tag:"span[data-citation]",getAttrs:e=>({id:e.getAttribute("data-id"),type:e.getAttribute("data-type")||"bibr"})},{tag:"sup[data-citation]",getAttrs:e=>({id:e.getAttribute("data-id"),type:e.getAttribute("data-type")||"bibr"})}],renderHTML(e){let{HTMLAttributes:t,mark:a}=e,{type:s}=a.attrs;return"fn"===s?["span",(0,F.P1)(this.options.HTMLAttributes,t,{"data-citation":"","data-id":t.id,"data-type":t.type,class:"footnote-linked-text",title:"Click to view footnote ".concat(t.id)}),0]:["sup",(0,F.P1)(this.options.HTMLAttributes,t,{"data-citation":"","data-id":t.id,"data-type":t.type}),0]},addCommands(){return{setCitation:e=>t=>{let{commands:a}=t;return a.setMark(this.name,e)},toggleCitation:e=>t=>{let{commands:a}=t;return a.toggleMark(this.name,e)},unsetCitation:()=>e=>{let{commands:t}=e;return t.unsetMark(this.name)}}}}),R=F.NB.create({name:"reference",group:"block",atom:!0,addOptions:()=>({HTMLAttributes:{}}),addAttributes:()=>({id:{default:null},type:{default:"element-citation"},publicationType:{default:"journal"},data:{default:{}},authors:{default:[]}}),parseHTML:()=>[{tag:"div[data-reference]"}],renderHTML(e){let{HTMLAttributes:t,node:a}=e,{id:s,type:n,publicationType:r,data:l}=a.attrs,i="",o=l.authors||a.attrs.authors||[];if("element-citation"===n){let e=o[0],t=e?"".concat(e.surname).concat(e.givenNames?", "+e.givenNames:""):"";i="[".concat(s,"] ").concat(t," ").concat(l.year||"")}else{var c;i="[".concat(s,"] ").concat((null===(c=l.content)||void 0===c?void 0:c.substring(0,50))||"","...")}return["div",(0,F.P1)(this.options.HTMLAttributes,t,{"data-reference":"","data-id":s,"data-type":n,"data-publication-type":r,class:"reference-item"}),i]},addCommands(){return{insertReference:e=>t=>{let{commands:a}=t;return a.insertContent({type:this.name,attrs:{id:e.id,type:e.type,publicationType:e.publicationType,data:e,authors:e.authors}})},updateReference:(e,t)=>a=>{let{commands:s,state:n}=a,r=!1,{tr:l}=n;return n.doc.descendants((a,s)=>{a.type.name===this.name&&a.attrs.id===e&&(l.setNodeMarkup(s,void 0,{...a.attrs,data:{...a.attrs.data,...t},authors:t.authors||a.attrs.authors}),r=!0)}),!!r&&(s.focus(),!0)},deleteReference:e=>t=>{let{commands:a,state:s}=t,n=!1,{tr:r}=s;return s.doc.descendants((t,a)=>{t.type.name===this.name&&t.attrs.id===e&&(r.delete(a,a+t.nodeSize),n=!0)}),!!n&&(a.focus(),!0)}}}}),P=F.NB.create({name:"footnote",group:"block",content:"text*",atom:!1,draggable:!1,addOptions:()=>({HTMLAttributes:{}}),addAttributes:()=>({id:{default:null},content:{default:""}}),parseHTML:()=>[{tag:"div[data-footnote]",getAttrs:e=>({id:e.getAttribute("data-id"),content:e.textContent||""})}],renderHTML(e){let{HTMLAttributes:t,node:a}=e,{id:s,content:n}=a.attrs;return["div",(0,F.P1)(this.options.HTMLAttributes,t,{"data-footnote":"","data-id":s,class:"footnote-item"}),["strong",{},"Footnote ".concat(s,": ")],["span",{},n]]},addCommands(){return{insertFootnote:e=>t=>{let{commands:a}=t;return a.insertContent({type:this.name,attrs:e})},updateFootnote:(e,t)=>a=>{let{commands:s,state:n}=a,r=!1,{tr:l}=n;return n.doc.descendants((a,s)=>{a.type.name===this.name&&a.attrs.id===e&&(l.setNodeMarkup(s,void 0,{...a.attrs,content:t}),r=!0)}),!!r&&(s.focus(),!0)},deleteFootnote:e=>t=>{let{commands:a,state:s}=t,n=!1,{tr:r}=s;return s.doc.descendants((t,a)=>{t.type.name===this.name&&t.attrs.id===e&&(r.delete(a,a+t.nodeSize),n=!0)}),!!n&&(a.focus(),!0)}}}});var J=a(7213);let O=F.hj.create({name:"autocompleteEnhanced",addOptions:()=>({triggerChar:"@",minQueryLength:0,maxSuggestions:10,debounceMs:300,apiEndpoint:"/api/autocomplete"}),addProseMirrorPlugins(){let e=this.options,t=this.editor;return[new J.Sy({key:new J.H$("autocompleteEnhanced"),view:a=>new U(a,e,t),props:{handleKeyDown(e,t){var a,s;let n=null===(s=this.getViewDesc)||void 0===s?void 0:null===(a=s.call(this,e))||void 0===a?void 0:a.autocompleteView;return null!=n&&!!n.isActive&&n.handleKeyDown(t)}}})]}});class U{createPopup(){this.popup=document.createElement("div"),this.popup.className="autocomplete-menu",this.popup.style.display="none",this.popup.style.position="absolute",this.popup.style.zIndex="9999",document.body.appendChild(this.popup);let e=document.createElement("div");e.className="autocomplete-hint",e.textContent="↑↓ Navigate • Enter Select • Esc Cancel",this.popup.appendChild(e)}update(e,t){let{state:a}=e,{selection:s}=a,{from:n,to:r}=s;s.empty&&n===r?this.checkForTrigger(e,n):this.isActive&&this.hidePopup()}checkForTrigger(e,t){let{state:a}=e,{doc:s}=a,n=s.textBetween(Math.max(0,t-50),t,"\0","\0").match(new RegExp("\\".concat(this.options.triggerChar,"([^\\s]*)$")));if(n){let e=n[1],a=t-e.length-1;e===this.query&&this.isActive||(this.range={from:a,to:t},this.query=e,this.debouncedSearch(e))}else this.isActive&&this.hidePopup()}debouncedSearch(e){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.searchSuggestions(e)},this.options.debounceMs)}async searchSuggestions(e){if(!(e.length<this.options.minQueryLength)||!(e.length>0))try{this.showLoading();let t=await fetch("".concat(this.options.apiEndpoint,"?q=").concat(encodeURIComponent(e),"&limit=").concat(this.options.maxSuggestions));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();this.suggestions=a.suggestions||[],this.selectedIndex=0,this.suggestions.length>0?(this.showPopup(),this.renderSuggestions()):this.showNoResults()}catch(e){console.error("Autocomplete search error:",e),this.showError()}}showLoading(){this.popup&&(this.popup.innerHTML='\n      <div class="autocomplete-loading">\n        Searching suggestions...\n      </div>\n      <div class="autocomplete-hint">↑↓ Navigate • Enter Select • Esc Cancel</div>\n    ',this.showPopup())}showNoResults(){this.popup&&(this.popup.innerHTML='\n      <div class="autocomplete-no-results">\n        No suggestions found for "'.concat(this.query,'"\n      </div>\n      <div class="autocomplete-hint">↑↓ Navigate • Enter Select • Esc Cancel</div>\n    '),this.showPopup())}showError(){this.popup&&(this.popup.innerHTML='\n      <div class="autocomplete-no-results">\n        Error loading suggestions\n      </div>\n      <div class="autocomplete-hint">↑↓ Navigate • Enter Select • Esc Cancel</div>\n    ',this.showPopup())}renderSuggestions(){if(!this.popup)return;let e=this.suggestions.map((e,t)=>{let a=t===this.selectedIndex,s=e.category?' data-category="'.concat(e.category,'"'):"";return'\n          <div class="autocomplete-item '.concat(a?"selected":"",'"').concat(s,' data-index="').concat(t,'">\n            <div class="autocomplete-label">').concat(this.escapeHtml(e.label),"</div>\n            ").concat(e.description?'<div class="autocomplete-description">'.concat(this.escapeHtml(e.description),"</div>"):"","\n          </div>\n        ")}).join("");this.popup.innerHTML="\n      ".concat(e,'\n      <div class="autocomplete-hint">↑↓ Navigate • Enter Select • Esc Cancel</div>\n    '),this.popup.querySelectorAll(".autocomplete-item").forEach((e,t)=>{e.addEventListener("click",()=>{this.selectedIndex=t,this.selectSuggestion()})})}showPopup(){if(!this.popup||!this.range)return;this.isActive=!0,this.popup.style.display="block";let e=this.view.coordsAtPos(this.range.from);this.view.dom.getBoundingClientRect();let t=this.popup.getBoundingClientRect(),a=e.left,s=e.bottom+4;a+t.width>window.innerWidth-20&&(a=window.innerWidth-t.width-20),a<20&&(a=20),s+t.height>window.innerHeight-20&&(s=e.top-t.height-4),this.popup.style.left="".concat(a,"px"),this.popup.style.top="".concat(s,"px")}hidePopup(){this.popup&&(this.popup.style.display="none"),this.isActive=!1,this.suggestions=[],this.selectedIndex=0,this.query="",this.range=null}handleKeyDown(e){if(!this.isActive)return!1;switch(e.key){case"ArrowDown":return e.preventDefault(),this.selectedIndex=Math.min(this.suggestions.length-1,this.selectedIndex+1),this.renderSuggestions(),!0;case"ArrowUp":return e.preventDefault(),this.selectedIndex=Math.max(0,this.selectedIndex-1),this.renderSuggestions(),!0;case"Enter":return e.preventDefault(),this.selectSuggestion(),!0;case"Escape":return e.preventDefault(),this.hidePopup(),!0;case"Tab":if(this.suggestions.length>0)return e.preventDefault(),this.selectSuggestion(),!0}return!1}selectSuggestion(){if(!this.range||this.selectedIndex>=this.suggestions.length)return;let e=this.suggestions[this.selectedIndex],{from:t,to:a}=this.range;this.view.dispatch(this.view.state.tr.replaceWith(t,a,this.view.state.schema.text(e.text)).scrollIntoView()),this.hidePopup(),this.view.focus()}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.popup&&this.popup.remove(),this.debounceTimer&&clearTimeout(this.debounceTimer)}constructor(e,t,a){this.popup=null,this.suggestions=[],this.selectedIndex=0,this.isActive=!1,this.query="",this.range=null,this.debounceTimer=null,this.view=e,this.options=t,this.editor=a,this.createPopup()}}let V=a(1670).X.extend({name:"headingWithId",addOptions:()=>({levels:[1,2,3],HTMLAttributes:{},onHeadingsChange:void 0}),addAttributes(){var e;return{...null===(e=this.parent)||void 0===e?void 0:e.call(this),id:{default:null,parseHTML:e=>e.id||null,renderHTML:e=>e.id?{id:e.id}:{}}}},addCommands(){var e;return{...null===(e=this.parent)||void 0===e?void 0:e.call(this),setHeadingWithId:e=>t=>{let{commands:a,state:s,tr:n}=t,{from:r,to:l}=s.selection,i=s.doc.textBetween(r,l," ").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||"heading",o="heading-".concat(i,"-").concat(Date.now());return a.setNode(this.name,{level:e.level,id:o})},toggleHeadingWithId:e=>t=>{let{commands:a,state:s}=t,{from:n,to:r}=s.selection,l=s.doc.textBetween(n,r," ").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||"heading",i="heading-".concat(l,"-").concat(Date.now());return a.toggleNode(this.name,"paragraph",{level:e.level,id:i})}}},addProseMirrorPlugins(){return[new J.Sy({key:new J.H$("headingIdTracker"),view:()=>({update:(e,t)=>{if(!this.options.onHeadingsChange)return;let a=[];e.state.doc.descendants((t,s)=>{if(t.type.name===this.name){let n=t.textContent,r=t.attrs.level,l=t.attrs.id;if(!l&&n){let r=n.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim();l="heading-".concat(r,"-").concat(a.length);let i=e.state.tr;i.setNodeMarkup(s,void 0,{...t.attrs,id:l}),e.dispatch(i)}l&&n&&a.push({id:l,text:n,level:r})}}),this.options.onHeadingsChange(a)}})})]},renderHTML(e){let{node:t,HTMLAttributes:a}=e,s=this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0];return["h".concat(s),{...this.options.HTMLAttributes,...a,class:"scroll-heading cursor-pointer hover:bg-gray-100 transition-colors rounded p-2","data-heading-level":s,id:t.attrs.id||void 0},0]}});var Y=a(1217);let B=e=>{let{node:t,selected:a,updateAttributes:r,editor:l}=e,{mathml:i,latex:o,altText:c,id:d}=t.attrs,u=(0,n.useRef)(null);return(0,n.useEffect)(()=>{u.current&&(a?u.current.classList.add("ProseMirror-selectednode"):u.current.classList.remove("ProseMirror-selectednode"))},[a]),(0,s.jsx)(L.T5,{as:"span",className:"inline-formula-wrapper ".concat(a?"selected":""),ref:u,onDoubleClick:()=>{let e=new CustomEvent("edit-formula",{detail:{type:"inline",data:{mathml:i,latex:o,altText:c,id:d}}});window.dispatchEvent(e)},style:{display:"inline-block",cursor:"pointer",padding:"0 2px",margin:"0 1px",borderRadius:"3px",backgroundColor:a?"rgba(100, 150, 255, 0.1)":"transparent",border:a?"1px solid rgba(100, 150, 255, 0.5)":"1px solid transparent",transition:"all 0.2s ease"},title:"Double-click to edit formula",children:i?(0,s.jsx)(Y.Z,{inline:!0,hideUntilTypeset:"first",children:i}):o?(0,s.jsx)(Y.Z,{inline:!0,hideUntilTypeset:"first",children:"\\(".concat(o,"\\)")}):(0,s.jsx)("span",{className:"formula-placeholder",children:c||"[Formula]"})})},X=F.NB.create({name:"inlineFormula",group:"inline",inline:!0,atom:!0,draggable:!1,addOptions:()=>({HTMLAttributes:{}}),addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},mathml:{default:null,parseHTML:e=>e.getAttribute("data-mathml"),renderHTML:e=>e.mathml?{"data-mathml":e.mathml}:{}},latex:{default:null,parseHTML:e=>e.getAttribute("data-latex"),renderHTML:e=>e.latex?{"data-latex":e.latex}:{}},altText:{default:null,parseHTML:e=>e.getAttribute("data-alt-text"),renderHTML:e=>e.altText?{"data-alt-text":e.altText}:{}}}),parseHTML:()=>[{tag:"span[data-inline-formula]",getAttrs:e=>({id:e.getAttribute("data-id")||null,mathml:e.getAttribute("data-mathml")||null,latex:e.getAttribute("data-latex")||null,altText:e.getAttribute("data-alt-text")||null})}],renderHTML(e){let{HTMLAttributes:t,node:a}=e;return["span",(0,F.P1)(this.options.HTMLAttributes,t,{"data-inline-formula":"",class:"inline-formula"}),a.attrs.altText||"[Formula]"]},addNodeView:()=>(0,L.fW)(B),addCommands(){return{insertInlineFormula:e=>t=>{let{commands:a}=t;return a.insertContent({type:this.name,attrs:e})},updateInlineFormula:e=>t=>{let{commands:a,state:s,tr:n}=t,{selection:r}=s,l=s.doc.nodeAt(r.from);if(l&&l.type.name===this.name){let t=r.from;return n.setNodeMarkup(t,void 0,{...l.attrs,...e}),!0}return!1}}}}),W=e=>{let{node:t,selected:a,updateAttributes:r,editor:l}=e,{mathml:i,latex:o,label:c,altText:d,id:u}=t.attrs,m=(0,n.useRef)(null);return(0,n.useEffect)(()=>{m.current&&(a?m.current.classList.add("ProseMirror-selectednode"):m.current.classList.remove("ProseMirror-selectednode"))},[a]),(0,s.jsxs)(L.T5,{as:"div",className:"display-formula-wrapper ".concat(a?"selected":""),ref:m,onDoubleClick:()=>{let e=new CustomEvent("edit-formula",{detail:{type:"display",data:{mathml:i,latex:o,label:c,altText:d,id:u}}});window.dispatchEvent(e)},style:{display:"block",cursor:"pointer",padding:"1em",margin:"1em 0",borderRadius:"4px",backgroundColor:a?"rgba(100, 150, 255, 0.05)":"transparent",border:a?"2px solid rgba(100, 150, 255, 0.5)":"2px solid transparent",transition:"all 0.2s ease",textAlign:"center"},title:"Double-click to edit formula",children:[c&&(0,s.jsx)("div",{className:"formula-label",style:{position:"absolute",right:"1em",fontSize:"0.9em",color:"#666",fontWeight:"bold"},children:c}),(0,s.jsx)("div",{className:"formula-content",style:{position:"relative"},children:i?(0,s.jsx)(Y.Z,{hideUntilTypeset:"first",children:i}):o?(0,s.jsx)(Y.Z,{hideUntilTypeset:"first",children:"\\[".concat(o,"\\]")}):(0,s.jsx)("div",{className:"formula-placeholder",style:{textAlign:"center",padding:"1em"},children:d||"[Display Formula]"})})]})},G=F.NB.create({name:"displayFormula",group:"block",atom:!0,draggable:!0,addOptions:()=>({HTMLAttributes:{}}),addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},mathml:{default:null,parseHTML:e=>e.getAttribute("data-mathml"),renderHTML:e=>e.mathml?{"data-mathml":e.mathml}:{}},latex:{default:null,parseHTML:e=>e.getAttribute("data-latex"),renderHTML:e=>e.latex?{"data-latex":e.latex}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}},altText:{default:null,parseHTML:e=>e.getAttribute("data-alt-text"),renderHTML:e=>e.altText?{"data-alt-text":e.altText}:{}}}),parseHTML:()=>[{tag:"div[data-display-formula]",getAttrs:e=>({id:e.getAttribute("data-id")||null,mathml:e.getAttribute("data-mathml")||null,latex:e.getAttribute("data-latex")||null,label:e.getAttribute("data-label")||null,altText:e.getAttribute("data-alt-text")||null})}],renderHTML(e){let{HTMLAttributes:t,node:a}=e,s=a.attrs.label,n=a.attrs.altText||"[Display Formula]",r=[];return s&&r.push(["div",{class:"formula-label"},s]),r.push(["div",{class:"formula-content"},n]),["div",(0,F.P1)(this.options.HTMLAttributes,t,{"data-display-formula":"",class:"display-formula"}),...r]},addNodeView:()=>(0,L.fW)(W),addCommands(){return{insertDisplayFormula:e=>t=>{let{commands:a}=t;return a.insertContent({type:this.name,attrs:e})},updateDisplayFormula:e=>t=>{let{commands:a,state:s,tr:n}=t,{selection:r}=s,l=s.doc.nodeAt(r.from);if(l&&l.type.name===this.name){let t=r.from;return n.setNodeMarkup(t,void 0,{...l.attrs,...e}),!0}return!1}}}});var _=a(3145);function K(e){let{isOpen:t,onClose:a,onSave:r,currentAlt:l="",currentAltText:i="",imageSrc:c}=e,[u,m]=(0,n.useState)(l),[h,x]=(0,n.useState)(i);if((0,n.useEffect)(()=>{m(l),x(i)},[l,i]),!t)return null;let g=()=>{m(l),x(i),a()};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>e.target===e.currentTarget&&g(),onKeyDown:e=>{"Escape"===e.key&&g()},children:(0,s.jsxs)(p.Zb,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(p.Ol,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(p.ll,{className:"flex items-center",children:[(0,s.jsx)(j.Z,{className:"h-5 w-5 mr-2"}),"Edit Image Alt-Text"]}),(0,s.jsx)(p.SZ,{className:"mt-2"})]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:g,className:"h-8 w-8 p-0",children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})]})}),(0,s.jsxs)(p.aY,{className:"space-y-6",children:[c&&(0,s.jsx)("div",{className:"flex justify-center bg-gray-50 p-4 rounded-lg",children:(0,s.jsx)("div",{className:"relative w-full max-w-full",style:{maxHeight:"16rem"},children:(0,s.jsx)(_.default,{src:c,alt:"Preview",width:800,height:600,className:"max-w-full max-h-64 object-contain rounded border shadow-sm",style:{width:"auto",height:"auto",maxHeight:"16rem"}})})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:["Basic Alt Text ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"Brief description of the image (e.g., 'Graph showing temperature trends over time')",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0}),(0,s.jsxs)("div",{className:"flex items-start mt-2 p-2 bg-blue-50 rounded text-xs text-blue-700",children:[(0,s.jsx)(j.Z,{className:"h-3 w-3 mr-1 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:"Keep this concise (under 125 characters). Used for screen readers and when images do not load."})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:["Detailed Alt-Text for JATS-XML ",(0,s.jsx)("span",{className:"text-gray-500",children:"(Optional)"})]}),(0,s.jsx)("textarea",{value:h,onChange:e=>x(e.target.value),placeholder:"Descrtiption'",rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical"}),h&&(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Character count: ",h.length]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,s.jsx)(d.z,{variant:"outline",onClick:g,children:"Cancel"}),(0,s.jsx)(d.z,{onClick:()=>{r(h,u),a()},disabled:!u.trim(),className:"min-w-[100px]",children:"Save Alt-Text"})]})]})]})})}var $=a(2926);let Q=e=>{let{isOpen:t,onClose:a,onSave:r,initialData:l,type:i}=e,[c,u]=(0,n.useState)("latex"),[m,h]=(0,n.useState)(""),[x,g]=(0,n.useState)(""),[f,b]=(0,n.useState)(""),[y,v]=(0,n.useState)("");(0,n.useEffect)(()=>{l&&(h(l.mathml||""),g(l.latex||""),b(l.label||""),v(l.id||""),l.latex?u("latex"):l.mathml&&u("mathml"))},[l]);let j=()=>{h(""),g(""),b(""),v(""),u("latex"),a()};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>e.target===e.currentTarget&&j(),onKeyDown:e=>{"Escape"===e.key&&j()},children:(0,s.jsxs)(p.Zb,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(p.Ol,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)($.Z,{className:"h-5 w-5 mr-2"}),(0,s.jsx)(p.ll,{children:"inline"===i?"Insert Inline Formula":"Insert Display Formula"})]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:j,className:"h-8 w-8 p-0",children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})]})}),(0,s.jsxs)(p.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex border-b",children:[(0,s.jsx)("button",{className:"px-4 py-2 font-medium transition-colors ".concat("latex"===c?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"),onClick:()=>u("latex"),children:"LaTeX"}),(0,s.jsx)("button",{className:"px-4 py-2 font-medium transition-colors ".concat("mathml"===c?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"),onClick:()=>u("mathml"),children:"MathML"})]}),"latex"===c&&(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"latex-input",className:"block text-sm font-medium text-gray-700",children:"LaTeX Formula"}),(0,s.jsx)("textarea",{id:"latex-input",className:"w-full min-h-[150px] p-3 border rounded-md font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"inline"===i?"e.g., E = mc^2":"e.g., \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}",value:x,onChange:e=>g(e.target.value)}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Enter LaTeX math code. Delimiters ($ or \\( \\)) are not needed."})]})}),"mathml"===c&&(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"mathml-input",className:"block text-sm font-medium text-gray-700",children:"MathML"}),(0,s.jsx)("textarea",{id:"mathml-input",className:"w-full min-h-[150px] p-3 border rounded-md font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:'<math xmlns="http://www.w3.org/1998/Math/MathML"> <mi>E</mi> <mo>=</mo> <mi>m</mi> <msup> <mi>c</mi> <mn>2</mn> </msup> </math>',value:m,onChange:e=>h(e.target.value)}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Enter valid MathML code with proper namespace."})]})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Preview"}),(0,s.jsx)("div",{className:"w-full min-h-[100px] p-4 border rounded-md bg-gray-50 flex items-center justify-center",children:(()=>{try{if("latex"===c&&x.trim())return(0,s.jsx)(Y.Z,{hideUntilTypeset:"first",children:"inline"===i?"\\(".concat(x,"\\)"):"\\[".concat(x,"\\]")});if("mathml"===c&&m.trim())return(0,s.jsx)(Y.Z,{hideUntilTypeset:"first",children:m});return(0,s.jsx)("div",{className:"text-gray-400 italic",children:"Preview will appear here"})}catch(e){return(0,s.jsx)("div",{className:"text-red-500",children:"Invalid formula syntax"})}})()})]}),"display"===i&&(0,s.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"label-input",className:"block text-sm font-medium text-gray-700",children:"Label (optional)"}),(0,s.jsx)("input",{id:"label-input",type:"text",className:"w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., (1)",value:f,onChange:e=>b(e.target.value)}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:'Equation label or number (e.g., "Equation 1" or "(1)")'})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"id-input",className:"block text-sm font-medium text-gray-700",children:"ID (optional)"}),(0,s.jsx)("input",{id:"id-input",type:"text",className:"w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., eq1",value:y,onChange:e=>v(e.target.value)}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Unique identifier for cross-referencing"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,s.jsx)(d.z,{variant:"outline",onClick:j,children:"Cancel"}),(0,s.jsx)(d.z,{onClick:()=>{let e={};"mathml"===c&&m.trim()?e.mathml=m.trim():"latex"===c&&x.trim()&&(e.latex=x.trim()),"display"===i&&(f.trim()&&(e.label=f.trim()),y.trim()&&(e.id=y.trim())),r(e),j()},disabled:"latex"===c&&!x.trim()||"mathml"===c&&!m.trim(),children:"Insert Formula"})]})]})]})}):null};var ee=a(265),et=a(8866),ea=a(6034),es=a(9397),en=a(1047),er=a(3229),el=a(8930),ei=a(8893);function eo(e){let{reference:t,index:a,onSave:r,onDelete:l,onCancel:i}=e,[c,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(t),[p,x]=(0,n.useState)(t.type||"element-citation");(0,n.useEffect)(()=>{console.log("\uD83D\uDCDD Reference prop updated in InlineReferenceEditor:",t),h({...t}),x(t.type||"element-citation")},[t]);let g=e=>{let t=m.authors||[];h({...m,authors:t.filter((t,a)=>a!==e)})},f=(e,t,a)=>{let s=[...m.authors||[]];s[e]={...s[e],[t]:a},h({...m,authors:s})};return c?(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mr-2",children:["[",a+1,"]"]}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Editing Reference"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"element-citation"===p?"Structured":"Mixed"}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>{let e="element-citation"===p?"mixed-citation":"element-citation";x(e),h({...m,type:e})},className:"h-6 w-12 p-0",title:"Switch to ".concat("element-citation"===p?"mixed-citation":"element-citation"),children:"element-citation"===p?(0,s.jsx)(et.Z,{className:"h-4 w-4 text-blue-600"}):(0,s.jsx)(ea.Z,{className:"h-4 w-4 text-green-600"})})]})]}),"element-citation"===p?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("select",{className:"px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.publicationType||"journal",onChange:e=>h({...m,publicationType:e.target.value}),children:[(0,s.jsx)("option",{value:"journal",children:"Journal"}),(0,s.jsx)("option",{value:"book",children:"Book"}),(0,s.jsx)("option",{value:"chapter",children:"Chapter"}),(0,s.jsx)("option",{value:"conference",children:"Conference"}),(0,s.jsx)("option",{value:"thesis",children:"Thesis"}),(0,s.jsx)("option",{value:"report",children:"Report"}),(0,s.jsx)("option",{value:"web",children:"Web"}),(0,s.jsx)("option",{value:"patent",children:"Patent"}),(0,s.jsx)("option",{value:"software",children:"Software"}),(0,s.jsx)("option",{value:"other",children:"Other"})]}),(0,s.jsx)("span",{className:"text-xs text-gray-500 col-span-2",children:"Publication Type"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Authors"}),(0,s.jsxs)(d.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{let e=m.authors||[];h({...m,authors:[...e,{surname:"",givenNames:""}]})},className:"h-8 px-3",children:[(0,s.jsx)(es.Z,{className:"h-3 w-3 mr-1"}),"Add Author"]})]}),(m.authors||[{surname:"",givenNames:""}]).map((e,t)=>{var a;return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 p-3 border border-gray-200 rounded-md bg-gray-50",children:[(0,s.jsx)("input",{type:"text",placeholder:"Surname",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:e.surname||"",onChange:e=>f(t,"surname",e.target.value)}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",placeholder:"Given names",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:e.givenNames||"",onChange:e=>f(t,"givenNames",e.target.value)}),((null===(a=m.authors)||void 0===a?void 0:a.length)||1)>1&&(0,s.jsx)(d.z,{type:"button",variant:"outline",size:"sm",onClick:()=>g(t),className:"h-10 px-3 text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,s.jsx)(en.Z,{className:"h-3 w-3"})})]})]},t)})]}),(0,s.jsx)("input",{type:"text",placeholder:"Article title",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.title||"",onChange:e=>h({...m,title:e.target.value})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsx)("input",{type:"text",placeholder:"Source/Journal",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.source||"",onChange:e=>h({...m,source:e.target.value})}),(0,s.jsx)("input",{type:"text",placeholder:"Year",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.year||"",onChange:e=>h({...m,year:e.target.value})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsx)("input",{type:"text",placeholder:"Volume",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.volume||"",onChange:e=>h({...m,volume:e.target.value})}),(0,s.jsx)("input",{type:"text",placeholder:"Issue",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.issue||"",onChange:e=>h({...m,issue:e.target.value})}),(0,s.jsx)("input",{type:"text",placeholder:"Pages (e.g., 123-145)",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.fpage||m.lpage?"".concat(m.fpage||"").concat(m.lpage?"-"+m.lpage:""):"",onChange:e=>{let t=e.target.value.trim();if(""===t)h({...m,fpage:"",lpage:""});else if(t.includes("-")){var a,s;let e=t.split("-");h({...m,fpage:(null===(a=e[0])||void 0===a?void 0:a.trim())||"",lpage:(null===(s=e[1])||void 0===s?void 0:s.trim())||""})}else h({...m,fpage:t,lpage:""})}})]})]}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("select",{className:"px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.publicationType||"journal",onChange:e=>h({...m,publicationType:e.target.value}),children:[(0,s.jsx)("option",{value:"journal",children:"Journal"}),(0,s.jsx)("option",{value:"book",children:"Book"}),(0,s.jsx)("option",{value:"chapter",children:"Chapter"}),(0,s.jsx)("option",{value:"conference",children:"Conference"}),(0,s.jsx)("option",{value:"thesis",children:"Thesis"}),(0,s.jsx)("option",{value:"report",children:"Report"}),(0,s.jsx)("option",{value:"web",children:"Web"}),(0,s.jsx)("option",{value:"patent",children:"Patent"}),(0,s.jsx)("option",{value:"software",children:"Software"}),(0,s.jsx)("option",{value:"other",children:"Other"})]}),(0,s.jsx)("span",{className:"text-xs text-gray-500 col-span-2",children:"Publication Type"})]}),(0,s.jsx)("textarea",{placeholder:"Complete citation text (e.g., Smith J, Doe A. Title of article. Journal Name. 2023;15(2):123-145.)",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical",rows:4,value:m.content||"",onChange:e=>h({...m,content:e.target.value})}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Mixed citations contain the complete formatted reference as free text."})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsxs)(d.z,{size:"sm",onClick:()=>{let e={type:p,publicationType:m.publicationType};"element-citation"===p?(e.authors=m.authors,e.title=m.title,e.source=m.source,e.year=m.year,e.volume=m.volume,e.issue=m.issue,e.fpage=m.fpage,e.lpage=m.lpage,e.content=void 0):(e.content=m.content,e.authors=void 0,e.title=void 0,e.source=void 0,e.year=void 0,e.volume=void 0,e.issue=void 0,e.fpage=void 0,e.lpage=void 0),console.log("\uD83D\uDCBE Saving reference updates:",e),r(t.id,e),u(!1)},disabled:!(()=>{if("element-citation"!==p)return m.content!==t.content||m.publicationType!==t.publicationType;{let e=JSON.stringify(m.authors)!==JSON.stringify(t.authors),a=m.title!==t.title,s=m.source!==t.source,n=m.year!==t.year,r=m.volume!==t.volume,l=m.issue!==t.issue,i=m.fpage!==t.fpage,o=m.lpage!==t.lpage,c=m.publicationType!==t.publicationType;return e||a||s||n||r||l||i||o||c}})(),children:[(0,s.jsx)(er.Z,{className:"h-3 w-3 mr-1"}),"Save"]}),(0,s.jsxs)(d.z,{size:"sm",variant:"outline",onClick:()=>{h({...t}),x(t.type||"element-citation"),u(!1),i()},children:[(0,s.jsx)(o.Z,{className:"h-3 w-3 mr-1"}),"Cancel"]}),(0,s.jsxs)(d.z,{size:"sm",variant:"destructive",onClick:()=>{window.confirm("Are you sure you want to delete this reference?")&&l(t.id)},className:"ml-auto",children:[(0,s.jsx)(el.Z,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})}):(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow group",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mr-2",children:["[",a+1,"]"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["ID: ",t.id]}),(0,s.jsx)("span",{className:"ml-2 text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600",children:"element-citation"===t.type?"Structured":"Mixed"}),(0,s.jsx)("span",{className:"ml-2 text-xs px-2 py-1 rounded-full bg-green-100 text-green-600",children:t.publicationType||"journal"})]}),"element-citation"===t.type?(0,s.jsxs)("div",{children:[t.authors&&t.authors.length>0&&(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Authors: "}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:t.authors.filter(e=>e.surname||e.givenNames).map(e=>"".concat(e.surname).concat(e.givenNames?", "+e.givenNames:"")).join("; ")}),t.authors.length>1&&(0,s.jsxs)("span",{className:"ml-2 text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-600",children:[t.authors.length," authors"]})]}),t.title&&(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Title: "}),(0,s.jsx)("span",{className:"text-sm text-gray-900 font-medium",children:t.title})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 text-xs text-gray-500",children:[t.source&&t.source.trim()&&(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{children:"Journal:"})," ",t.source]}),t.year&&t.year.trim()&&(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{children:"Year:"})," ",t.year]}),t.volume&&t.volume.trim()&&(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{children:"Vol:"})," ",t.volume]}),t.issue&&t.issue.trim()&&(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{children:"Issue:"})," ",t.issue]}),t.fpage&&t.lpage&&(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{children:"Pages:"})," ",t.fpage,"-",t.lpage]})]})]}):(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Citation: "}),(0,s.jsx)("span",{className:"text-sm text-gray-900",children:t.content||"No content"})]})})]}),(0,s.jsx)(d.z,{size:"sm",variant:"ghost",onClick:()=>u(!0),className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(ei.Z,{className:"h-3 w-3"})})]})})}let ec=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bibr",a='[data-citation][data-id="'.concat(e,'"][data-type="').concat(t,'"]'),s=document.querySelector(a);s?(s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("citation-active"),setTimeout(()=>{s.classList.remove("citation-active");let t=document.querySelectorAll('[data-citation][data-id="'.concat(e,'"]'));t.forEach(e=>e.classList.add("citation-highlight")),setTimeout(()=>{t.forEach(e=>e.classList.remove("citation-highlight"))},3e3)},1e3)):console.warn("No citation found with ID: ".concat(e))};function ed(e){let{references:t,onUpdateReference:a,onDeleteReference:n}=e;return 0===t.length?null:(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5 mr-2"}),"References (",t.length,")"]}),(0,s.jsxs)(d.z,{variant:"outline",size:"sm",onClick:()=>{t.length>0&&ec(t[0].id,"bibr")},title:"Go to first reference citation in editor",className:"text-xs",children:[(0,s.jsx)(ee.Z,{className:"h-3 w-3 mr-1"}),"Go to Body"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"relative footer-section","data-reference-id":e.id,children:[(0,s.jsx)(eo,{reference:e,index:t,onSave:a,onDelete:n,onCancel:()=>{}}),(0,s.jsx)("button",{onClick:()=>ec(e.id,"bibr"),className:"citation-nav-btn",title:"Navigate to first citation in editor body",children:(0,s.jsx)(ee.Z,{className:"h-3 w-3 text-blue-600"})})]},e.id))})]})}var eu=a(4656);function em(e){let{footnote:t,index:a,onSave:r,onDelete:l,onCancel:i}=e,[c,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(t.content);return((0,n.useEffect)(()=>{h(t.content)},[t.content]),c)?(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 mr-2",children:["[",a+1,"]"]}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Editing Footnote"})]}),(0,s.jsx)("textarea",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical",rows:4,placeholder:"Enter footnote content...",value:m,onChange:e=>h(e.target.value)}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsxs)(d.z,{size:"sm",onClick:()=>{r(t.id,m.trim()),u(!1)},disabled:!m.trim(),children:[(0,s.jsx)(er.Z,{className:"h-3 w-3 mr-1"}),"Save"]}),(0,s.jsxs)(d.z,{size:"sm",variant:"outline",onClick:()=>{h(t.content),u(!1),i()},children:[(0,s.jsx)(o.Z,{className:"h-3 w-3 mr-1"}),"Cancel"]}),(0,s.jsxs)(d.z,{size:"sm",variant:"destructive",onClick:()=>{window.confirm("Are you sure you want to delete this footnote?")&&l(t.id)},className:"ml-auto",children:[(0,s.jsx)(el.Z,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})}):(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow group",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 mr-2",children:["[",a+1,"]"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["ID: ",t.id]})]}),(0,s.jsx)("div",{className:"text-sm text-gray-900 leading-relaxed",children:t.content||"No content"})]}),(0,s.jsx)(d.z,{size:"sm",variant:"ghost",onClick:()=>u(!0),className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(ei.Z,{className:"h-3 w-3"})})]})})}let eh=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fn",a='[data-citation][data-id="'.concat(e,'"][data-type="').concat(t,'"]'),s=document.querySelector(a);s?(s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("citation-active"),setTimeout(()=>{s.classList.remove("citation-active");let t=document.querySelectorAll('[data-citation][data-id="'.concat(e,'"]'));t.forEach(e=>e.classList.add("citation-highlight")),setTimeout(()=>{t.forEach(e=>e.classList.remove("citation-highlight"))},3e3)},1e3)):console.warn("No citation found with ID: ".concat(e))};function ep(e){let{footnotes:t,onUpdateFootnote:a,onDeleteFootnote:n}=e;return 0===t.length?null:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,s.jsx)(eu.Z,{className:"h-5 w-5 mr-2"}),"Footnotes (",t.length,")"]}),(0,s.jsxs)(d.z,{variant:"outline",size:"sm",onClick:()=>{t.length>0&&eh(t[0].id,"fn")},title:"Go to first footnote citation in editor",className:"text-xs",children:[(0,s.jsx)(ee.Z,{className:"h-3 w-3 mr-1"}),"Go to Body"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"relative footer-section","data-footnote-id":e.id,children:[(0,s.jsx)(em,{footnote:e,index:t,onSave:a,onDelete:n,onCancel:()=>{}}),(0,s.jsx)("button",{onClick:()=>eh(e.id,"fn"),className:"citation-nav-btn",title:"Navigate to first citation in editor body",children:(0,s.jsx)(ee.Z,{className:"h-3 w-3 text-blue-600"})})]},e.id))})]})}var ex=a(1401),eg={loader:{load:["input/mml","output/svg"]},startup:{typeset:!1},svg:{fontCache:"global",scale:1,minScale:.5,matchFontHeight:!0,mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipAttributes:{},exFactor:.5,displayAlign:"center",displayIndent:"0"},options:{enableMenu:!1,renderActions:{addMenu:[]}}};function ef(e){let t=e;return e.includes("mml:")||(t=e.replace(/<(\/?)(\w+)/g,"<$1mml:$2")),t.includes("xmlns:mml")||(t=t.replace(/<mml:math/,'<mml:math xmlns:mml="'.concat("http://www.w3.org/1998/Math/MathML",'"'))),t}var eb=a(5965),ey=a(4353),ev=a(1328),ej=a(9680),eN=a(4519),ew=a(9747),eC=a(9022),eS=a(3247),eA=a(5698),ek=a(2655),eT=a(5846),eq=a(2029),eL=a(3113),eE=a(2207),eM=a(8310),eD=a(2735);function ez(e){let{initialContent:t,onContentChange:a,onHeadingsChange:r,onReferencesChange:i,onFootnotesChange:o,onEditorReady:c,references:u=[],footnotes:m=[],onUpdateReference:h,onDeleteReference:p,onUpdateFootnote:x,onDeleteFootnote:g,onAddReference:f,onAddFootnote:b,scrollToHeadingId:y,onOpenCitationSearch:v,onOpenFootnoteSearch:j,jatsXml:N=""}=e,[w,C]=(0,n.useState)(""),[S,A]=(0,n.useState)(!1),[k,T]=(0,n.useState)(!1),[q,F]=(0,n.useState)("inline"),[J,U]=(0,n.useState)(null),[Y,B]=(0,n.useState)(!1),W=(0,n.useRef)(null),[_,ee]=(0,n.useState)(null),et=(0,L.jE)({immediatelyRender:!1,extensions:[E.Z.configure({heading:!1}),V.configure({levels:[1,2,3],HTMLAttributes:{class:"scroll-heading cursor-pointer hover:bg-gray-100 transition-colors rounded p-2"},onHeadingsChange:r}),Z.ZP.configure({inline:!1,allowBase64:!0,HTMLAttributes:{class:"max-w-full h-auto rounded-lg"}}).extend({renderHTML(e){let{node:t,HTMLAttributes:a}=e;return["img",{...a,class:"max-w-full h-auto rounded-lg cursor-pointer","data-alt-text":t.attrs["alt-text"]||"",style:"cursor: pointer;"}]}}).extend({addAttributes(){var e;return{...null===(e=this.parent)||void 0===e?void 0:e.call(this),"alt-text":{default:null,parseHTML:e=>e.getAttribute("data-alt-text"),renderHTML:e=>e["alt-text"]?{"data-alt-text":e["alt-text"]}:{}}}},addCommands(){var e;return{...null===(e=this.parent)||void 0===e?void 0:e.call(this),updateImageAltText:e=>t=>{let{tr:a,state:s}=t,{selection:n}=s,r=s.doc.nodeAt(n.from);return!!r&&r.type.name===this.name&&(a.setNodeMarkup(n.from,void 0,{...r.attrs,"alt-text":e}),!0)}}}}),M.ZP.configure({resizable:!0}),D.Z,I.Z,z.Z,H,R,P,X,G,O.configure({triggerChar:"@",minQueryLength:0,maxSuggestions:10,debounceMs:300,apiEndpoint:"/api/autocomplete"})],content:t||"",onUpdate:e=>{let{editor:t}=e,s=t.getHTML();C(s),null==a||a(s,"")},onCreate:e=>{let{editor:t}=e;if(!document.querySelector("#autocomplete-styles")){let e=document.createElement("link");e.id="autocomplete-styles",e.rel="stylesheet",e.href="/styles/autocomplete.css",document.head.appendChild(e)}let a=e=>{let t=e.target;if(t.matches("h1, h2, h3")){let e=t.getAttribute("id");if(e){let t=document.querySelector('[data-heading-id="'.concat(e,'"]'));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("bg-blue-100"),setTimeout(()=>{t.classList.remove("bg-blue-100")},2e3))}}},s=e=>{let a=e.target;if("IMG"===a.tagName){if(e.preventDefault(),e.stopPropagation(),"dblclick"===e.type){let e=a.getAttribute("alt")||"",s=a.getAttribute("data-alt-text")||"",n=a.getAttribute("src")||"",r=-1;t.state.doc.descendants((e,t)=>{if("image"===e.type.name&&e.attrs.src===n)return r=t,!1}),ee({src:n,alt:e,altText:s,position:r>=0?r:void 0}),A(!0)}return}if(a.classList.contains("footnote-linked-text")){let e=a.getAttribute("data-id");if(e){let t=document.querySelector('[data-footnote][data-id="'.concat(e,'"]'));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("footnote-highlight"),setTimeout(()=>{t.classList.remove("footnote-highlight")},2e3))}}if(a.hasAttribute("data-citation")){e.preventDefault();let t=a.getAttribute("data-id"),s=a.getAttribute("data-type");if(t&&s){let e=document.querySelector("bibr"===s?'[data-reference-id="'.concat(t,'"]'):'[data-footnote-id="'.concat(t,'"]'));if(e){e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("footer-item-active"),setTimeout(()=>{e.classList.remove("footer-item-active"),e.classList.add("footer-item-highlight"),setTimeout(()=>{e.classList.remove("footer-item-highlight")},3e3)},1e3);let a=document.querySelectorAll('[data-citation][data-id="'.concat(t,'"]'));setTimeout(()=>{a.forEach(e=>e.classList.add("citation-highlight")),setTimeout(()=>{a.forEach(e=>e.classList.remove("citation-highlight"))},2e3)},500)}}}},n=e=>{let{type:t,data:a}=e.detail;F(t),U(a),T(!0)},r=t.view.dom;r.addEventListener("click",s),r.addEventListener("dblclick",s),r.addEventListener("click",a),window.addEventListener("edit-formula",n),t.footnoteClickCleanup=()=>{r.removeEventListener("click",s),r.removeEventListener("dblclick",s),r.removeEventListener("click",a),window.removeEventListener("edit-formula",n)},t.scrollToHeading=e=>{setTimeout(()=>{let t=r.closest(".editor-container");if(t){let a=t.querySelector("#".concat(e));a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("heading-highlight"),setTimeout(()=>{a.classList.remove("heading-highlight")},2e3))}},100)}}});(0,n.useEffect)(()=>{if(y&&et){var e;null===(e=et.scrollToHeading)||void 0===e||e.call(et,y)}},[y,et]),(0,n.useEffect)(()=>{et&&c&&c(et)},[et,c]),(0,n.useEffect)(()=>{et&&t&&et.commands.setContent(t)},[et,t]);let ea=async()=>{try{let e=await fetch("/api/converttopdf",{method:"POST",headers:{"Content-Type":"application/xml"},body:N});if(e.ok){let t=await e.blob(),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="article.pdf",s.click(),URL.revokeObjectURL(a)}else alert("Failed to generate PDF")}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF")}},en=(0,n.useCallback)(()=>{null==et||et.chain().focus().undo().run()},[et]),er=(0,n.useCallback)(()=>{null==et||et.chain().focus().redo().run()},[et]),ei=(0,n.useCallback)(()=>{null==et||et.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},[et]),eo=(0,n.useCallback)(()=>{null==et||et.chain().focus().addRowAfter().run()},[et]),ec=(0,n.useCallback)(()=>{null==et||et.chain().focus().addColumnAfter().run()},[et]),eu=(0,n.useCallback)(()=>{null==et||et.chain().focus().deleteTable().run()},[et]),em=(0,n.useCallback)(()=>{let e=window.prompt("Enter image URL:");e&&(null==et||et.chain().focus().setImage({src:e,alt:""}).run(),ee({src:e,alt:"",altText:""}),A(!0))},[et]),eh=(0,n.useCallback)(()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){let e=new FileReader;e.onload=e=>{var t;let s=null===(t=e.target)||void 0===t?void 0:t.result;s&&"string"==typeof s&&(null==et||et.chain().focus().setImage({src:s,alt:a.name}).run(),ee({src:s,alt:a.name,altText:""}),A(!0))},e.readAsDataURL(a)}},e.click()},[et]),ef=(0,n.useCallback)(()=>{if(!et)return;let{selection:e}=et.state,t=et.state.doc.nodeAt(e.from);if(t&&"image"===t.type.name){let a=t.attrs.alt||"",s=t.attrs["alt-text"]||"";ee({src:t.attrs.src||"",alt:a,altText:s,position:e.from}),A(!0)}else alert("Please select an image first")},[et]),ez=(0,n.useCallback)(()=>{if(!et)return;let{selection:e}=et.state,t=et.state.doc.nodeAt(e.from);t&&"image"===t.type.name?window.confirm("Are you sure you want to delete this image?")&&et.chain().focus().deleteSelection().run():alert("Please select an image first")},[et]),eI=(0,n.useCallback)((e,t)=>{if(et&&_){if(void 0!==_.position&&_.position>=0)et.chain().focus().setTextSelection(_.position).updateAttributes("image",{alt:t,"alt-text":e}).run();else{let{state:a}=et,s=!1,{tr:n}=a;if(a.doc.descendants((a,r)=>{if("image"===a.type.name&&a.attrs.src===_.src)return n.setNodeMarkup(r,void 0,{...a.attrs,alt:t,"alt-text":e}),s=!0,!1}),s)et.view.dispatch(n);else{let{state:a}=et,s=-1;a.doc.descendants((e,t)=>{"image"===e.type.name&&e.attrs.src===_.src&&(s=t)}),-1!==s&&et.chain().focus().setTextSelection(s).updateAttributes("image",{alt:t,"alt-text":e}).run()}}ee(null)}},[et,_]),eZ=(0,n.useCallback)(()=>{ee(null),A(!1)},[]),eF=(0,n.useCallback)(e=>{null==et||et.chain().focus().toggleHeadingWithId({level:e}).run()},[et]);(0,n.useCallback)(()=>{let e=window.prompt("Enter reference ID (e.g., ref1):");e&&et&&et.chain().focus().setCitation({id:e,type:"bibr"}).run()},[et]);let eH=(0,n.useCallback)(()=>{et&&et.chain().focus().insertContent("@").run()},[et]),eR=(0,n.useCallback)(()=>{F("inline"),U(null),T(!0)},[]),eP=(0,n.useCallback)(()=>{F("display"),U(null),T(!0)},[]),eJ=(0,n.useCallback)(e=>{et&&(J?"inline"===q?et.chain().focus().updateInlineFormula(e).run():et.chain().focus().updateDisplayFormula(e).run():"inline"===q?et.chain().focus().insertInlineFormula(e).run():et.chain().focus().insertDisplayFormula(e).run(),U(null))},[et,q,J]),eO=(0,n.useCallback)(()=>{T(!1),U(null)},[]);return et?(0,s.jsx)(ex.Z,{config:eg,children:(0,s.jsxs)("div",{className:"w-full border border-gray-200 rounded-lg overflow-hidden bg-white",children:[(0,s.jsxs)("div",{className:"sticky top-0 z-10 border-b border-gray-200 p-2 flex gap-1 items-center bg-gray-50 flex-wrap",children:[(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:en,disabled:!et.can().undo(),title:"Undo",children:(0,s.jsx)(eb.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:er,disabled:!et.can().redo(),title:"Redo",children:(0,s.jsx)(ey.Z,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsx)(d.z,{variant:et.isActive("bold")?"default":"ghost",size:"sm",onClick:()=>et.chain().focus().toggleBold().run(),children:(0,s.jsx)(ev.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:et.isActive("italic")?"default":"ghost",size:"sm",onClick:()=>et.chain().focus().toggleItalic().run(),children:(0,s.jsx)(ej.Z,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsx)(d.z,{variant:et.isActive("headingWithId",{level:1})?"default":"ghost",size:"sm",onClick:()=>eF(1),title:"Heading 1",children:(0,s.jsx)(eN.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:et.isActive("headingWithId",{level:2})?"default":"ghost",size:"sm",onClick:()=>eF(2),title:"Heading 2",children:(0,s.jsx)(ew.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:et.isActive("headingWithId",{level:3})?"default":"ghost",size:"sm",onClick:()=>eF(3),title:"Heading 3",children:(0,s.jsx)(eC.Z,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>null==v?void 0:v(),title:"Search and insert citation",children:(0,s.jsx)(eS.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>null==j?void 0:j(),title:"Search and insert footnote",children:(0,s.jsx)(eA.Z,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:eH,title:"Trigger autocomplete suggestions",children:(0,s.jsx)(ek.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>B(!Y),title:"Autocomplete help",children:(0,s.jsx)(eT.Z,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:ei,title:"Insert table",children:(0,s.jsx)(eq.Z,{className:"h-4 w-4"})}),et.isActive("table")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:eo,title:"Add row",children:[(0,s.jsx)(es.Z,{className:"h-4 w-4"}),(0,s.jsx)(eq.Z,{className:"h-3 w-3 ml-1"})]}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:ec,title:"Add column",children:[(0,s.jsx)(eq.Z,{className:"h-3 w-3 mr-1"}),(0,s.jsx)(es.Z,{className:"h-4 w-4"})]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:eu,title:"Delete table",children:(0,s.jsx)(el.Z,{className:"h-4 w-4"})})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:em,title:"Insert image from URL",children:(0,s.jsx)(eL.Z,{className:"h-4 w-4"})}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:eh,title:"Upload image",children:[(0,s.jsx)(eL.Z,{className:"h-4 w-4"}),(0,s.jsx)(es.Z,{className:"h-3 w-3 -ml-1"})]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:ef,title:"Edit selected image (or double-click image)",children:(0,s.jsx)(eE.Z,{className:"h-4 w-4"})}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:ez,title:"Delete selected image",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,s.jsx)(el.Z,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:eR,title:"Insert inline formula",children:(0,s.jsx)($.Z,{className:"h-4 w-4"})}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:eP,title:"Insert display formula (equation)",children:[(0,s.jsx)(eM.Z,{className:"h-4 w-4"}),(0,s.jsx)($.Z,{className:"h-3 w-3 -ml-1"})]}),(0,s.jsxs)("div",{className:"ml-auto flex gap-1 items-center",children:[(0,s.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:()=>{let e=new Blob([N],{type:"application/xml"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="article.xml",a.click(),URL.revokeObjectURL(t)},title:"Export as JATS XML",children:[(0,s.jsx)(eD.Z,{className:"h-4 w-4 mr-1"}),"XML"]}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:ea,title:"Export as PDF",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4 mr-1"}),"PDF"]})]})]}),(0,s.jsxs)("div",{className:"overflow-y-auto max-h-[1000px]",children:[Y&&(0,s.jsx)("div",{className:"border-b border-gray-200 bg-blue-50 p-3",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Smart Autocomplete"}),(0,s.jsxs)("p",{className:"text-xs text-blue-700 mb-2",children:["Type ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-blue-200 rounded text-xs",children:"@"})," followed by text to get intelligent suggestions for academic writing, research terms, and common phrases."]}),(0,s.jsxs)("div",{className:"text-xs text-blue-600",children:[(0,s.jsx)("strong",{children:"Examples:"})," @methodology, @statistical, @furthermore, @according to"]})]}),(0,s.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:()=>B(!1),className:"text-blue-600 hover:text-blue-800",children:[(0,s.jsx)("span",{className:"sr-only",children:"Close"}),"\xd7"]})]})}),(0,s.jsx)("div",{ref:W,className:"editor-container",children:(0,s.jsx)(L.kg,{editor:et,className:"prose prose-lg max-w-none p-6 focus:outline-none min-h-[400px] jats-editor-content"})}),(0,s.jsx)("div",{className:"border-t border-gray-200 bg-gray-50",children:(0,s.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-100",children:(0,s.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,s.jsxs)(d.z,{size:"sm",variant:"outline",onClick:()=>{let e={id:Date.now().toString(),type:"element-citation",publicationType:"journal",authors:[{surname:"",givenNames:""}],title:"",source:""};null==f||f(e)},children:[(0,s.jsx)(es.Z,{className:"h-4 w-4 mr-1"}),"Add References"]}),(0,s.jsxs)(d.z,{size:"sm",variant:"outline",onClick:()=>{let e={id:Date.now().toString(),content:""};null==b||b(e)},children:[(0,s.jsx)(es.Z,{className:"h-4 w-4 mr-1"}),"Add Footnote"]})]})})}),(0,s.jsx)(ed,{references:u,onUpdateReference:h||(()=>{}),onDeleteReference:p||(()=>{})}),(0,s.jsx)(ep,{footnotes:m,onUpdateFootnote:x||(()=>{}),onDeleteFootnote:g||(()=>{})})]}),(0,s.jsx)(K,{isOpen:S,onClose:eZ,onSave:eI,currentAlt:(null==_?void 0:_.alt)||"",currentAltText:(null==_?void 0:_.altText)||"",imageSrc:null==_?void 0:_.src}),(0,s.jsx)(Q,{isOpen:k,onClose:eO,onSave:eJ,type:q,initialData:J||void 0})]})}):(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:"Loading editor..."})}let eI=(0,n.memo)(function(e){let{references:t,footnotes:a,onContentChange:n,onHeadingsChange:r,onEditorReady:i,onUpdateReference:o,onDeleteReference:c,onUpdateFootnote:d,onDeleteFootnote:u,onAddReference:m,onAddFootnote:h,scrollToHeadingId:x,onOpenCitationSearch:g,onOpenFootnoteSearch:f,jatsXml:b}=e;return(0,s.jsxs)(p.Zb,{children:[(0,s.jsxs)(p.Ol,{className:"pb-2",children:[(0,s.jsx)(p.ll,{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5 mr-2"}),"Article Editor"]})}),(0,s.jsx)(p.SZ,{children:"Create and edit your JATS-compliant scientific article"})]}),(0,s.jsx)(p.aY,{className:"p-0",children:(0,s.jsx)(ez,{initialContent:"",onContentChange:n,onHeadingsChange:r,onEditorReady:i,references:t,footnotes:a,onUpdateReference:o,onDeleteReference:c,onUpdateFootnote:d,onDeleteFootnote:u,onAddReference:m,onAddFootnote:h,scrollToHeadingId:x,onOpenCitationSearch:g,onOpenFootnoteSearch:f,jatsXml:b})})]})},(e,t)=>{let a=JSON.stringify(e.references)!==JSON.stringify(t.references),s=JSON.stringify(e.footnotes)!==JSON.stringify(t.footnotes);return!a&&!s&&e.scrollToHeadingId===t.scrollToHeadingId&&e.onContentChange===t.onContentChange&&e.onHeadingsChange===t.onHeadingsChange&&e.onEditorReady===t.onEditorReady&&e.onUpdateReference===t.onUpdateReference&&e.onDeleteReference===t.onDeleteReference&&e.onUpdateFootnote===t.onUpdateFootnote&&e.onDeleteFootnote===t.onDeleteFootnote&&e.onAddReference===t.onAddReference&&e.onAddFootnote===t.onAddFootnote&&e.onOpenCitationSearch===t.onOpenCitationSearch});function eZ(e){let{editor:t,references:a,footnotes:r,onAddReference:l,onUpdateReference:i,onDeleteReference:o,onAddFootnote:c,onUpdateFootnote:d,onDeleteFootnote:u}=e,[m,h]=(0,n.useState)(!1),[p,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)(null),[b,y]=(0,n.useState)(null),[v,j]=(0,n.useState)("element-citation"),[N,w]=(0,n.useState)({type:"element-citation",publicationType:"journal",authors:[{surname:"",givenNames:""}]}),[C,S]=(0,n.useState)({content:""}),[A,k]=(0,n.useState)({}),[T,q]=(0,n.useState)("");return(0,s.jsx)("div",{className:"space-y-4"})}var eF=a(7877),eH=a(407);function eR(e){let{headings:t,onScrollToHeading:a}=e,n=e=>{console.log("\uD83C\uDFAF Navigation: Attempting to scroll to heading: ".concat(e)),a(e);let s=[()=>document.querySelector("#".concat(e)),()=>{var t;return null===(t=document.querySelector(".editor-container"))||void 0===t?void 0:t.querySelector("#".concat(e))},()=>{var t;return null===(t=document.querySelector(".jats-editor-content"))||void 0===t?void 0:t.querySelector("#".concat(e))},()=>{var a;let s=null===(a=t.find(t=>t.id===e))||void 0===a?void 0:a.text;return s?Array.from(document.querySelectorAll("h1, h2, h3")).find(e=>{var t;return(null===(t=e.textContent)||void 0===t?void 0:t.trim())===s.trim()}):null},()=>{var t;return null===(t=document.querySelector(".ProseMirror"))||void 0===t?void 0:t.querySelector("#".concat(e))}],n=null;for(let e=0;e<s.length;e++)try{if(n=s[e]()){console.log("✅ Found heading using strategy ".concat(e+1));break}}catch(t){console.warn("❌ Strategy ".concat(e+1," failed:"),t)}if(n){console.log("\uD83D\uDCCD Scrolling to heading:",n),n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("heading-highlight"),setTimeout(()=>{n.classList.remove("heading-highlight")},2e3);let t=document.querySelector('[data-heading-id="'.concat(e,'"]'));t&&(t.classList.add("bg-blue-100"),setTimeout(()=>{t.classList.remove("bg-blue-100")},1e3))}else{console.error("❌ Could not find heading with ID: ".concat(e)),console.log("\uD83D\uDD0D Available headings in DOM:"),document.querySelectorAll("h1, h2, h3").forEach((e,t)=>{var a;console.log("  ".concat(t,": ").concat(e.tagName,' id="').concat(e.id,'" text="').concat(null===(a=e.textContent)||void 0===a?void 0:a.trim(),'"'))});let a=t.find(t=>t.id===e);if(a){let e=Array.from(document.querySelectorAll("h1, h2, h3")).find(e=>{var t;return(null===(t=e.textContent)||void 0===t?void 0:t.trim().toLowerCase())===a.text.toLowerCase()});e&&(console.log("\uD83C\uDFAF Found matching heading by text, scrolling..."),e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("heading-highlight"),setTimeout(()=>{e.classList.remove("heading-highlight")},2e3))}}};return(0,s.jsxs)(p.Zb,{children:[(0,s.jsx)(p.Ol,{className:"pb-3",children:(0,s.jsxs)(p.ll,{className:"text-sm flex items-center",children:[(0,s.jsx)(eF.Z,{className:"h-4 w-4 mr-2"}),"Document Navigation",(0,s.jsxs)("span",{className:"ml-auto text-xs text-gray-500",children:["(",t.length,")"]})]})}),(0,s.jsx)(p.aY,{className:"space-y-1",children:0===t.length?(0,s.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No sections yet. Add headings to see navigation."}):(0,s.jsx)("nav",{className:"space-y-1",children:t.map(e=>(0,s.jsxs)("button",{"data-heading-id":e.id,onClick:()=>n(e.id),className:"\n                  w-full text-left px-2 py-1 rounded text-sm hover:bg-gray-100 \n                  flex items-center group transition-all duration-200\n                  ".concat(1===e.level?"font-semibold":"","\n                  ").concat(2===e.level?"pl-4":"","\n                  ").concat(3===e.level?"pl-8":"","\n                "),title:"Navigate to: ".concat(e.text," (ID: ").concat(e.id,")"),children:[(0,s.jsx)(eH.Z,{className:"h-3 w-3 mr-1 text-gray-400 group-hover:text-gray-600"}),(0,s.jsx)("span",{className:"truncate",children:e.text}),(0,s.jsxs)("span",{className:"ml-auto text-xs text-gray-400 opacity-0 group-hover:opacity-100",children:["H",e.level]})]},e.id))})})]})}function eP(e){let{validationResults:t,onShowDetails:a}=e;return(0,s.jsxs)(p.Zb,{children:[(0,s.jsx)(p.Ol,{className:"pb-3",children:(0,s.jsxs)(p.ll,{className:"text-sm flex items-center",children:[t.isValid?(0,s.jsx)(b.Z,{className:"h-4 w-4 text-green-500 mr-2"}):(0,s.jsx)(y.Z,{className:"h-4 w-4 text-red-500 mr-2"}),"Validation Status"]})}),(0,s.jsxs)(p.aY,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Critical Errors"}),(0,s.jsx)(u.C,{variant:t.errorCount>0?"destructive":"secondary",children:t.errorCount})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Warnings"}),(0,s.jsx)(u.C,{variant:"secondary",children:t.warningCount})]}),(0,s.jsxs)(d.z,{variant:"outline",size:"sm",onClick:a,className:"w-full mt-3",children:[(0,s.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),"View Details"]})]})]})}var eJ=a(3639);function eO(e){let{isOpen:t,onClose:a,validationResults:n}=e;return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&a()},onKeyDown:e=>{"Escape"===e.key&&a()},children:(0,s.jsxs)(p.Zb,{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[(0,s.jsx)(p.Ol,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(p.ll,{className:"flex items-center",children:[n.isValid?(0,s.jsx)(b.Z,{className:"h-5 w-5 text-green-500 mr-2"}):(0,s.jsx)(y.Z,{className:"h-5 w-5 text-red-500 mr-2"}),"JATS Validation Report"]}),(0,s.jsx)(p.SZ,{className:"mt-2",children:"Detailed validation results for your JATS document"})]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:a,className:"h-8 w-8 p-0",children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})]})}),(0,s.jsx)(p.aY,{className:"overflow-y-auto max-h-[calc(90vh-120px)]",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-gray-50",children:[(0,s.jsx)("div",{className:"flex items-center",children:n.isValid?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Z,{className:"h-6 w-6 text-green-500 mr-3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-green-800",children:"Document is Valid"}),(0,s.jsx)("p",{className:"text-sm text-green-600",children:"Your JATS document passes all critical validation checks"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Z,{className:"h-6 w-6 text-red-500 mr-3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-red-800",children:"Document has Issues"}),(0,s.jsx)("p",{className:"text-sm text-red-600",children:"Critical errors must be fixed for valid JATS"})]})]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(u.C,{variant:n.errorCount>0?"destructive":"secondary",children:[n.errorCount," Errors"]}),(0,s.jsxs)(u.C,{variant:"secondary",children:[n.warningCount," Warnings"]})]})]}),n.criticalErrors.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(y.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,s.jsxs)("h3",{className:"text-lg font-semibold text-red-800",children:["Critical Errors (",n.criticalErrors.length,")"]})]}),(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-sm text-red-700 mb-3",children:"These errors must be fixed for your document to be valid JATS XML:"}),(0,s.jsx)("div",{className:"space-y-2",children:n.criticalErrors.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-6 h-6 bg-red-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:(0,s.jsx)("span",{className:"text-xs font-medium text-red-600",children:t+1})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm text-red-800 font-medium",children:e.split(":")[0]}),e.includes(":")&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:e.split(":").slice(1).join(":").trim()})]})]},t))})]})]}),n.warnings.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(eJ.Z,{className:"h-5 w-5 text-yellow-500 mr-2"}),(0,s.jsxs)("h3",{className:"text-lg font-semibold text-yellow-800",children:["Warnings (",n.warnings.length,")"]})]}),(0,s.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-sm text-yellow-700 mb-3",children:"These issues are recommended to fix for better JATS compliance:"}),(0,s.jsx)("div",{className:"space-y-2",children:n.warnings.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:(0,s.jsx)("span",{className:"text-xs font-medium text-yellow-600",children:t+1})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm text-yellow-800 font-medium",children:e.split(":")[0]}),e.includes(":")&&(0,s.jsx)("p",{className:"text-sm text-yellow-600 mt-1",children:e.split(":").slice(1).join(":").trim()})]})]},t))})]})]}),n.isValid&&0===n.criticalErrors.length&&0===n.warnings.length&&(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(b.Z,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"Perfect!"}),(0,s.jsx)("p",{className:"text-green-600",children:"Your JATS document has no validation issues and follows all best practices."})]}),(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)(j.Z,{className:"h-5 w-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"About JATS Validation"}),(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"JATS (Journal Article Tag Suite) is a technical standard that defines the XML tagging that describes the content and metadata of journal articles. Critical errors prevent your document from being valid JATS, while warnings indicate areas for improvement."})]})]})})]})})]})}):null}var eU=a(1947);function eV(e){let{jatsXml:t}=e;return(0,s.jsxs)(p.Zb,{children:[(0,s.jsx)(p.Ol,{className:"pb-3",children:(0,s.jsxs)(p.ll,{className:"text-sm flex items-center",children:[(0,s.jsx)(eD.Z,{className:"h-4 w-4 mr-2"}),"Export Options"]})}),(0,s.jsx)(p.aY,{className:"space-y-2",children:(0,s.jsxs)(d.z,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{let e=new Blob([t],{type:"text/xml"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="article.xml",s.click(),URL.revokeObjectURL(a)},children:[(0,s.jsx)(eU.Z,{className:"h-4 w-4 mr-2"}),"Export as JATS XML"]})})]})}function eY(e){let{editorInstance:t,references:a,footnotes:r,headings:l,validationResults:i,jatsXml:o,onAddReference:c,onUpdateReference:d,onDeleteReference:u,onAddFootnote:m,onUpdateFootnote:h,onDeleteFootnote:p,onScrollToHeading:x}=e,[g,f]=(0,n.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,s.jsx)(eR,{headings:l,onScrollToHeading:x}),(0,s.jsx)(eP,{validationResults:i,onShowDetails:()=>f(!0)}),(0,s.jsx)(eZ,{editor:t,references:a,footnotes:r,onAddReference:c,onUpdateReference:d,onDeleteReference:u,onAddFootnote:m,onUpdateFootnote:h,onDeleteFootnote:p}),(0,s.jsx)(eV,{jatsXml:o})]}),(0,s.jsx)(eO,{isOpen:g,onClose:()=>f(!1),validationResults:i})]})}var eB=a(505);let eX={journalTitle:"Sample Journal",articleTitle:"Article Title",authors:[],affiliations:[],keywords:[]};function eW(e){let{isOpen:t,onClose:a,onSave:r,initialData:i}=e,[c,m]=(0,n.useState)(i||eX),[h,x]=(0,n.useState)("journal");if((0,n.useEffect)(()=>{i&&m(i)},[i]),!t)return null;let g=(e,t)=>{m({...c,authors:c.authors.map(a=>a.id===e?{...a,...t}:a)})},f=e=>{m({...c,authors:c.authors.filter(t=>t.id!==e)})},b=(e,t)=>{m({...c,affiliations:c.affiliations.map(a=>a.id===e?{...a,...t}:a)})},y=e=>{m({...c,affiliations:c.affiliations.filter(t=>t.id!==e),authors:c.authors.map(t=>({...t,affiliations:t.affiliations.filter(t=>t!==e)}))})},v=(e,t)=>{let a=[...c.keywords];a[e]=t,m({...c,keywords:a})},j=e=>{m({...c,keywords:c.keywords.filter((t,a)=>a!==e)})},N=[{id:"journal",label:"Journal",icon:A.Z},{id:"article",label:"Article",icon:l.Z},{id:"authors",label:"Authors",icon:S.Z},{id:"publication",label:"Publication",icon:eB.Z},{id:"abstract",label:"Abstract & Keywords",icon:l.Z},{id:"meta",label:"Metadata",icon:l.Z}];return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>e.target===e.currentTarget&&a(),children:(0,s.jsxs)(p.Zb,{className:"w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,s.jsx)(p.Ol,{className:"border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(p.ll,{className:"flex items-center",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5 mr-2"}),"JATS Front Matter Editor"]}),(0,s.jsx)(p.SZ,{className:"mt-2",children:"Edit journal and article metadata according to JATS standards"})]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:a,className:"h-8 w-8 p-0",children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})]})}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-48 border-r bg-gray-50 p-4 space-y-1",children:N.map(e=>{let t=e.icon;return(0,s.jsxs)("button",{onClick:()=>x(e.id),className:"w-full flex items-center px-3 py-2 text-sm rounded-md transition-colors ".concat(h===e.id?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-200"),children:[(0,s.jsx)(t,{className:"h-4 w-4 mr-2"}),e.label]},e.id)})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:["journal"===h&&(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Journal Information"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["Journal Title ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:c.journalTitle,onChange:e=>m({...c,journalTitle:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Journal of Scientific Research"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Journal Abbreviation"}),(0,s.jsx)("input",{type:"text",value:c.journalAbbrev||"",onChange:e=>m({...c,journalAbbrev:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"J Sci Res"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"ISSN"}),(0,s.jsx)("input",{type:"text",value:c.issn||"",onChange:e=>m({...c,issn:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1234-5678"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"ISSN Type"}),(0,s.jsxs)("select",{value:c.issnType||"print",onChange:e=>m({...c,issnType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"print",children:"Print"}),(0,s.jsx)("option",{value:"electronic",children:"Electronic"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Publisher"}),(0,s.jsx)("input",{type:"text",value:c.publisher||"",onChange:e=>m({...c,publisher:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Academic Publishing House"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Publisher Location"}),(0,s.jsx)("input",{type:"text",value:c.publisherLocation||"",onChange:e=>m({...c,publisherLocation:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"New York, NY"})]})]})]})}),"article"===h&&(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Article Information"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["Article Title ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:c.articleTitle,onChange:e=>m({...c,articleTitle:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"The Main Title of Your Article"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Article Subtitle"}),(0,s.jsx)("input",{type:"text",value:c.articleSubtitle||"",onChange:e=>m({...c,articleSubtitle:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"A Comprehensive Study"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Article Type"}),(0,s.jsxs)("select",{value:c.articleType||"research-article",onChange:e=>m({...c,articleType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"research-article",children:"Research Article"}),(0,s.jsx)("option",{value:"review-article",children:"Review Article"}),(0,s.jsx)("option",{value:"case-report",children:"Case Report"}),(0,s.jsx)("option",{value:"editorial",children:"Editorial"}),(0,s.jsx)("option",{value:"letter",children:"Letter"}),(0,s.jsx)("option",{value:"brief-report",children:"Brief Report"}),(0,s.jsx)("option",{value:"correction",children:"Correction"}),(0,s.jsx)("option",{value:"other",children:"Other"})]})]})]})]})}),"authors"===h&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Affiliations"}),(0,s.jsxs)(d.z,{size:"sm",onClick:()=>{let e={id:"aff-".concat(Date.now()),institution:""};m({...c,affiliations:[...c.affiliations,e]})},children:[(0,s.jsx)(es.Z,{className:"h-4 w-4 mr-1"}),"Add Affiliation"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:c.affiliations.map((e,t)=>(0,s.jsx)(p.Zb,{children:(0,s.jsxs)(p.aY,{className:"pt-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)(u.C,{variant:"secondary",children:["Affiliation ",t+1]}),(0,s.jsx)(d.z,{size:"sm",variant:"ghost",onClick:()=>y(e.id),children:(0,s.jsx)(el.Z,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("input",{type:"text",value:e.institution,onChange:t=>b(e.id,{institution:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Institution name"})}),(0,s.jsx)("input",{type:"text",value:e.department||"",onChange:t=>b(e.id,{department:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Department"}),(0,s.jsx)("input",{type:"text",value:e.city||"",onChange:t=>b(e.id,{city:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"City"}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("input",{type:"text",value:e.country||"",onChange:t=>b(e.id,{country:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Country"})})]})]})},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Authors"}),(0,s.jsxs)(d.z,{size:"sm",onClick:()=>{let e={id:"author-".concat(Date.now()),surname:"",givenNames:"",affiliations:[]};m({...c,authors:[...c.authors,e]})},children:[(0,s.jsx)(es.Z,{className:"h-4 w-4 mr-1"}),"Add Author"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:c.authors.map((e,t)=>(0,s.jsx)(p.Zb,{children:(0,s.jsxs)(p.aY,{className:"pt-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(u.C,{variant:"secondary",children:["Author ",t+1]}),e.corresp&&(0,s.jsx)(u.C,{children:"Corresponding"})]}),(0,s.jsx)(d.z,{size:"sm",variant:"ghost",onClick:()=>f(e.id),children:(0,s.jsx)(el.Z,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("input",{type:"text",value:e.givenNames,onChange:t=>g(e.id,{givenNames:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Given names"}),(0,s.jsx)("input",{type:"text",value:e.surname,onChange:t=>g(e.id,{surname:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Surname"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("input",{type:"text",value:e.email||"",onChange:t=>g(e.id,{email:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email"}),(0,s.jsx)("input",{type:"text",value:e.orcid||"",onChange:t=>g(e.id,{orcid:t.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ORCID"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium mb-1 text-gray-600",children:"Affiliations"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:c.affiliations.map((t,a)=>(0,s.jsxs)("label",{className:"flex items-center text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:e.affiliations.includes(t.id),onChange:a=>{let s=a.target.checked?[...e.affiliations,t.id]:e.affiliations.filter(e=>e!==t.id);g(e.id,{affiliations:s})},className:"mr-2"}),"Affiliation ",a+1]},t.id))})]}),(0,s.jsxs)("label",{className:"flex items-center text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:e.corresp||!1,onChange:t=>g(e.id,{corresp:t.target.checked}),className:"mr-2"}),"Corresponding author"]})]})]})},e.id))})]})]}),"publication"===h&&(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Publication Information"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Volume"}),(0,s.jsx)("input",{type:"text",value:c.volume||"",onChange:e=>m({...c,volume:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"15"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Issue"}),(0,s.jsx)("input",{type:"text",value:c.issue||"",onChange:e=>m({...c,issue:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"3"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"First Page"}),(0,s.jsx)("input",{type:"text",value:c.fpage||"",onChange:e=>m({...c,fpage:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"123"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Last Page"}),(0,s.jsx)("input",{type:"text",value:c.lpage||"",onChange:e=>m({...c,lpage:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"145"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Publication Date"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,s.jsx)("input",{type:"text",value:c.pubDay||"",onChange:e=>m({...c,pubDay:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Day"}),(0,s.jsx)("input",{type:"text",value:c.pubMonth||"",onChange:e=>m({...c,pubMonth:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Month"}),(0,s.jsx)("input",{type:"text",value:c.pubYear||"",onChange:e=>m({...c,pubYear:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Year"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"DOI"}),(0,s.jsx)("input",{type:"text",value:c.doi||"",onChange:e=>m({...c,doi:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10.1234/journal.2024.123456"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Article ID"}),(0,s.jsx)("input",{type:"text",value:c.articleId||"",onChange:e=>m({...c,articleId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ART123456"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Copyright & License"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("input",{type:"text",value:c.copyrightYear||"",onChange:e=>m({...c,copyrightYear:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Copyright year"}),(0,s.jsx)("input",{type:"text",value:c.copyrightHolder||"",onChange:e=>m({...c,copyrightHolder:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Copyright holder"}),(0,s.jsx)("textarea",{value:c.copyrightStatement||"",onChange:e=>m({...c,copyrightStatement:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical",rows:2,placeholder:"Copyright statement"}),(0,s.jsx)("input",{type:"text",value:c.license||"",onChange:e=>m({...c,license:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"License (e.g., CC BY 4.0)"}),(0,s.jsx)("input",{type:"text",value:c.licenseUrl||"",onChange:e=>m({...c,licenseUrl:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"License URL"})]})]})]})]})}),"abstract"===h&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Abstract"}),(0,s.jsx)("textarea",{value:c.abstract||"",onChange:e=>m({...c,abstract:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical",rows:8,placeholder:"Enter the abstract of your article..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Keywords"}),(0,s.jsxs)(d.z,{size:"sm",onClick:()=>{m({...c,keywords:[...c.keywords,""]})},children:[(0,s.jsx)(es.Z,{className:"h-4 w-4 mr-1"}),"Add Keyword"]})]}),(0,s.jsx)("div",{className:"space-y-2",children:c.keywords.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:e,onChange:e=>v(t,e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter keyword"}),(0,s.jsx)(d.z,{size:"sm",variant:"ghost",onClick:()=>j(t),children:(0,s.jsx)(el.Z,{className:"h-4 w-4"})})]},t))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Funding Statement"}),(0,s.jsx)("textarea",{value:c.fundingStatement||"",onChange:e=>m({...c,fundingStatement:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical",rows:4,placeholder:"Enter funding information..."})]})]}),"meta"===h&&(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Article Dates"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Received Date"}),(0,s.jsx)("input",{type:"date",value:c.receivedDate||"",onChange:e=>m({...c,receivedDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Accepted Date"}),(0,s.jsx)("input",{type:"date",value:c.acceptedDate||"",onChange:e=>m({...c,acceptedDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Published Date"}),(0,s.jsx)("input",{type:"date",value:c.publishedDate||"",onChange:e=>m({...c,publishedDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})})]})]}),(0,s.jsxs)("div",{className:"border-t p-4 flex justify-between items-center bg-gray-50",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Required fields are marked with ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.z,{variant:"outline",onClick:a,children:"Cancel"}),(0,s.jsx)(d.z,{onClick:()=>{r(c),a()},children:"Save Front Matter"})]})]})]})})}let eG={journalTitle:"Sample Journal",articleTitle:"Generated Article",authors:[],affiliations:[],keywords:[]};function e_(){let[e,t]=(0,n.useState)(""),[a,i]=(0,n.useState)(""),[c,u]=(0,n.useState)([]),[h,p]=(0,n.useState)([]),[x,g]=(0,n.useState)([]),[f,b]=(0,n.useState)(null),[y,v]=(0,n.useState)(!1),[j,N]=(0,n.useState)(null),[w,C]=(0,n.useState)(eG),[S,A]=(0,n.useState)(!1),[k,T]=(0,n.useState)(!1),[L,E]=(0,n.useState)(""),[M,D]=(0,n.useState)(!1),[z,I]=(0,n.useState)(""),Z=(0,n.useMemo)(()=>a?function(e){let t=e.filter(e=>e.includes("Missing")||e.includes("required")||e.includes("not a valid JATS")||e.includes("parsing error")),a=e.filter(e=>e.includes("recommended")||e.includes("should")||e.includes("missing")||e.includes("namespace"));return{isValid:0===t.length,errorCount:t.length,warningCount:a.length,criticalErrors:t,warnings:a}}(function(e){let t=[];try{if(!e||""===e.trim())return t.push("JATS XML content is empty"),t;let a=new DOMParser().parseFromString(e,"text/xml"),s=a.querySelector("parsererror");if(s)return t.push("XML parsing error: ".concat(s.textContent)),t;e.includes("<?xml")||t.push("Missing XML declaration"),r.forEach(e=>{let s=e.check(a);s&&"error"===e.type&&t.push("".concat(e.name,": ").concat(s))});let n=a.querySelector("article");if(n){n.getAttribute("dtd-version")||t.push("Missing dtd-version attribute on article element"),!(n.hasAttribute("xmlns:xlink")||e.includes("xmlns:xlink="))&&a.querySelector("xref, ext-link, graphic")&&t.push("Missing XLink namespace declaration but XLink elements found");let s=a.querySelector("math, inline-formula, disp-formula"),r=n.hasAttribute("xmlns:mml")||e.includes("xmlns:mml=")||e.includes('xmlns="http://www.w3.org/1998/Math/MathML"');s&&!r&&t.push("Missing MathML namespace declaration but math elements found")}let l=a.querySelector("front");if(l){let e=l.querySelector("journal-meta");e&&(e.querySelector("journal-title-group, journal-title")||t.push("Missing journal title in journal-meta"),e.querySelector("issn")||t.push("Missing ISSN in journal-meta (recommended)"));let a=l.querySelector("article-meta");a&&(a.querySelector("title-group")||t.push("Missing title-group in article-meta"),a.querySelector("contrib-group")||t.push("Missing contrib-group in article-meta (recommended)"),a.querySelector("pub-date")||t.push("Missing pub-date in article-meta (recommended)"))}let i=Array.from(a.querySelectorAll("[id]")).map(e=>e.getAttribute("id")),o=i.filter((e,t)=>i.indexOf(e)!==t);o.length>0&&t.push("Duplicate IDs found: ".concat([...new Set(o)].join(", ")));let c=a.querySelectorAll("xref[rid]");Array.from(c).forEach(e=>{let s=e.getAttribute("rid");s&&!a.getElementById(s)&&t.push("Cross-reference points to non-existent ID: ".concat(s))})}catch(e){t.push("Validation error: ".concat(e))}return t}(a)):{isValid:!0,errorCount:0,warningCount:0,criticalErrors:[],warnings:[]},[a]),F=(0,n.useCallback)(e=>{u(t=>t.length!==e.length?e:t.some((t,a)=>{let s=e[a];return!s||t.id!==s.id||t.text!==s.text||t.level!==s.level})?e:t)},[]),H=(0,n.useCallback)(e=>{b(e)},[]),R=(0,n.useCallback)(e=>{let t=new DOMParser().parseFromString(e,"text/html"),a=[];return t.querySelectorAll("h1, h2, h3").forEach((e,t)=>{let s=parseInt(e.tagName.substring(1)),n=e.textContent||"",r=n.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim(),l="heading-".concat(r,"-").concat(t);e.setAttribute("id",l),a.push({id:l,text:n,level:s})}),a},[]),P=(0,n.useCallback)((e,t)=>{let a='<table-wrap id="table-sec'.concat(t,'">\n      <table frame="hsides" rules="groups">\n        <thead>'),s=e.querySelectorAll("th");return s.length>0&&(a+="<tr>",s.forEach(e=>{a+="<th>".concat(e.textContent,"</th>")}),a+="</tr>"),a+="</thead><tbody>",e.querySelectorAll("tr").forEach(e=>{let t=e.querySelectorAll("td");t.length>0&&(a+="<tr>",t.forEach(e=>{a+="<td>".concat(e.textContent,"</td>")}),a+="</tr>")}),a+="</tbody></table></table-wrap>"},[]),J=(0,n.useCallback)((e,t)=>{let a=e.getAttribute("data-alt-text")||e.getAttribute("alt")||"",s=e.src||"";return'<fig id="fig-sec'.concat(t,'">\n      <graphic xlink:href="').concat(s,'"').concat(a?' alt-text="'.concat(a.replace(/"/g,"&quot;"),'"'):""," />\n      <caption>\n        <title>Figure ").concat(t,"</title>\n        ").concat(a?"<p>".concat(a,"</p>"):"","\n      </caption>\n    </fig>")},[]),O=(0,n.useCallback)(e=>{let t=document.createElement("textarea");return t.innerHTML=e,t.value},[]),U=(0,n.useCallback)(e=>{let t=e.getAttribute("data-id")||"",a=e.getAttribute("data-mathml")||"",s=e.getAttribute("data-latex")||"",n=t?' id="'.concat(t,'"'):"",r=a?O(a):"",l=s?O(s):"",i=r?ef(r):"";return i&&l?"<inline-formula".concat(n,"><alternatives>").concat(i,"<tex-math><![CDATA[").concat(l,"]]></tex-math></alternatives></inline-formula>"):i?"<inline-formula".concat(n,">").concat(i,"</inline-formula>"):l?"<inline-formula".concat(n,"><tex-math><![CDATA[").concat(l,"]]></tex-math></inline-formula>"):""},[O]),V=(0,n.useCallback)(e=>{let t=e.getAttribute("data-id")||"",a=e.getAttribute("data-mathml")||"",s=e.getAttribute("data-latex")||"",n=e.getAttribute("data-label")||"",r=a?O(a):"",l=s?O(s):"",i=r?ef(r):"",o="";return n&&(o+="<label>".concat(n,"</label>")),i&&l?o+="<alternatives>".concat(i,"<tex-math><![CDATA[").concat(l,"]]></tex-math></alternatives>"):i?o+=i:l&&(o+="<tex-math><![CDATA[".concat(l,"]]></tex-math>")),"<disp-formula".concat(t?' id="'.concat(t,'"'):"",">").concat(o,"</disp-formula>")},[O]),Y=(0,n.useCallback)(e=>{let t="<front>\n";if(t+="  <journal-meta>\n",e.journalTitle&&(t+="    <journal-title-group>\n"+"      <journal-title>".concat(e.journalTitle,"</journal-title>\n"),e.journalAbbrev&&(t+="      <abbrev-journal-title>".concat(e.journalAbbrev,"</abbrev-journal-title>\n")),t+="    </journal-title-group>\n"),e.issn&&(t+='    <issn pub-type="'.concat(e.issnType||"print",'">').concat(e.issn,"</issn>\n")),e.publisher&&(t+="    <publisher>\n"+"      <publisher-name>".concat(e.publisher,"</publisher-name>\n"),e.publisherLocation&&(t+="      <publisher-loc>".concat(e.publisherLocation,"</publisher-loc>\n")),t+="    </publisher>\n"),t+="  </journal-meta>\n  <article-meta>\n",e.doi&&(t+='    <article-id pub-id-type="doi">'.concat(e.doi,"</article-id>\n")),e.articleId&&(t+='    <article-id pub-id-type="publisher-id">'.concat(e.articleId,"</article-id>\n")),t+="    <title-group>\n"+"      <article-title>".concat(e.articleTitle,"</article-title>\n"),e.articleSubtitle&&(t+="      <subtitle>".concat(e.articleSubtitle,"</subtitle>\n")),t+="    </title-group>\n",e.authors.length>0&&(t+="    <contrib-group>\n",e.authors.forEach(e=>{t+='      <contrib contrib-type="author"'.concat(e.corresp?' corresp="yes"':"",">\n")+"        <name>\n"+"          <surname>".concat(e.surname,"</surname>\n")+"          <given-names>".concat(e.givenNames,"</given-names>\n"),e.prefix&&(t+="          <prefix>".concat(e.prefix,"</prefix>\n")),e.suffix&&(t+="          <suffix>".concat(e.suffix,"</suffix>\n")),t+="        </name>\n",e.email&&(t+="        <email>".concat(e.email,"</email>\n")),e.orcid&&(t+='        <contrib-id contrib-id-type="orcid">'.concat(e.orcid,"</contrib-id>\n")),e.affiliations.forEach(e=>{t+='        <xref ref-type="aff" rid="'.concat(e,'"/>\n')}),t+="      </contrib>\n"}),t+="    </contrib-group>\n"),e.affiliations.length>0&&e.affiliations.forEach(e=>{t+='    <aff id="'.concat(e.id,'">\n')+"      <institution-wrap>\n"+"        <institution>".concat(e.institution,"</institution>\n")+"      </institution-wrap>\n",e.department&&(t+='      <addr-line><named-content content-type="department">'.concat(e.department,"</named-content></addr-line>\n")),e.city&&(t+="      <city>".concat(e.city,"</city>\n")),e.country&&(t+="      <country>".concat(e.country,"</country>\n")),t+="    </aff>\n"}),e.pubYear&&(t+='    <pub-date pub-type="epub">\n',e.pubDay&&(t+="      <day>".concat(e.pubDay,"</day>\n")),e.pubMonth&&(t+="      <month>".concat(e.pubMonth,"</month>\n")),t+="      <year>".concat(e.pubYear,"</year>\n")+"    </pub-date>\n"),e.volume&&(t+="    <volume>".concat(e.volume,"</volume>\n")),e.issue&&(t+="    <issue>".concat(e.issue,"</issue>\n")),e.fpage&&(t+="    <fpage>".concat(e.fpage,"</fpage>\n")),e.lpage&&(t+="    <lpage>".concat(e.lpage,"</lpage>\n")),e.receivedDate||e.acceptedDate||e.publishedDate){if(t+="    <history>\n",e.receivedDate){let a=new Date(e.receivedDate);t+='      <date date-type="received">\n'+"        <day>".concat(a.getDate(),"</day>\n")+"        <month>".concat(a.getMonth()+1,"</month>\n")+"        <year>".concat(a.getFullYear(),"</year>\n")+"      </date>\n"}if(e.acceptedDate){let a=new Date(e.acceptedDate);t+='      <date date-type="accepted">\n'+"        <day>".concat(a.getDate(),"</day>\n")+"        <month>".concat(a.getMonth()+1,"</month>\n")+"        <year>".concat(a.getFullYear(),"</year>\n")+"      </date>\n"}t+="    </history>\n"}return(e.copyrightYear||e.copyrightHolder||e.license)&&(t+="    <permissions>\n",e.copyrightYear&&e.copyrightHolder&&(t+="      <copyright-statement>\xa9 ".concat(e.copyrightYear," ").concat(e.copyrightHolder,"</copyright-statement>\n")+"      <copyright-year>".concat(e.copyrightYear,"</copyright-year>\n")+"      <copyright-holder>".concat(e.copyrightHolder,"</copyright-holder>\n")),e.license&&(t+="      <license".concat(e.licenseUrl?' xlink:href="'.concat(e.licenseUrl,'"'):"",">\n")+"        <license-p>".concat(e.license,"</license-p>\n")+"      </license>\n"),t+="    </permissions>\n"),e.abstract&&(t+="    <abstract>\n"+"      <p>".concat(e.abstract,"</p>\n")+"    </abstract>\n"),e.keywords.length>0&&(t+="    <kwd-group>\n",e.keywords.forEach(e=>{e.trim()&&(t+="      <kwd>".concat(e,"</kwd>\n"))}),t+="    </kwd-group>\n"),e.fundingStatement&&(t+="    <funding-group>\n"+"      <funding-statement>".concat(e.fundingStatement,"</funding-statement>\n")+"    </funding-group>\n"),t+="  </article-meta>\n</front>"},[]),B=(0,n.useCallback)((e,t,a,s)=>{let n=new DOMParser().parseFromString(e,"text/html"),r="",l="",i=0,o=e=>{if(e.nodeType===Node.ELEMENT_NODE)switch(e.tagName.toLowerCase()){case"h1":case"h2":case"h3":l&&(r+=l+"</sec>",l=""),i++,l='<sec id="sec'.concat(i,'"><title>').concat(e.textContent,"</title>");break;case"p":let t="";e.childNodes.forEach(e=>{if(e.nodeType===Node.TEXT_NODE)t+=e.textContent;else if(e.nodeType===Node.ELEMENT_NODE){if("SUP"===e.tagName&&e.hasAttribute("data-citation")){let a=e.getAttribute("data-id"),s=e.getAttribute("data-type")||"bibr";t+='<sup><xref ref-type="'.concat(s,'" rid="').concat(a,'">').concat(e.textContent,"</xref></sup>")}else if(e.hasAttribute("data-citation")){let a=e.getAttribute("data-id"),s=e.getAttribute("data-type")||"fn";t+='<xref ref-type="'.concat(s,'" rid="').concat(a,'">').concat(e.textContent,"</xref>")}else e.hasAttribute("data-inline-formula")?t+=U(e):t+=e.textContent}});let a="<p>".concat(t,"</p>");l?l+=a:r+=a;break;case"div":if(e.hasAttribute("data-footnote")||e.hasAttribute("data-reference"))break;if(e.hasAttribute("data-display-formula")){let t=V(e);l?l+=t:r+=t;break}e.childNodes.forEach(e=>o(e));break;case"table":let s=P(e,i);l?l+=s:r+=s;break;case"img":let n=J(e,i);l?l+=n:r+=n;break;default:e.childNodes.forEach(e=>o(e))}};n.body.childNodes.forEach(e=>o(e)),l&&(r+=l+"</sec>");let c="";a.length>0&&(c="<fn-group>",a.forEach(e=>{c+='<fn id="'.concat(e.id,'"><p>').concat(e.content,"</p></fn>")}),c+="</fn-group>");let d="";t.length>0&&(d="<ref-list><title>References</title>",t.forEach(e=>{if("element-citation"===e.type){var t;d+='<ref id="'.concat(e.id,'">\n            <element-citation publication-type="').concat(e.publicationType,'">\n              <person-group person-group-type="author">'),null===(t=e.authors)||void 0===t||t.forEach(e=>{d+="<name>\n              <surname>".concat(e.surname,"</surname>\n              <given-names>").concat(e.givenNames,"</given-names>\n            </name>")}),d+="</person-group>\n              <article-title>".concat(e.title||"","</article-title>\n              <source>").concat(e.source||"","</source>\n              <year>").concat(e.year||"","</year>\n              <volume>").concat(e.volume||"","</volume>\n              <issue>").concat(e.issue||"","</issue>\n              <fpage>").concat(e.fpage||"","</fpage>\n              <lpage>").concat(e.lpage||"","</lpage>\n            </element-citation>\n          </ref>")}else d+='<ref id="'.concat(e.id,'">\n            <mixed-citation publication-type="').concat(e.publicationType,'">').concat(e.content,"</mixed-citation>\n          </ref>")}),d+="</ref-list>");let u=s||w,m=Y(u);return'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.3 20210610//EN" "JATS-journalpublishing1-3.dtd">\n<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="'.concat(u.articleType||"research-article",'" dtd-version="1.3" xml:lang="en">\n  ').concat(m,"\n  <body>\n    ").concat(r,"\n  </body>\n  <back>\n    ").concat(c,"\n    ").concat(d,"\n  </back>\n</article>")},[w,Y,P,J,U,V]),X=(0,n.useCallback)((a,s)=>{a!==e&&(t(a),i(B(a,h,x)))},[e,h,x,B]),W=(0,n.useCallback)(e=>{let a;if(p(t=>t.length===e.references.length&&t.every((t,a)=>{var s;return t.id===(null===(s=e.references[a])||void 0===s?void 0:s.id)})?t:e.references),g(t=>t.length===e.footnotes.length&&t.every((t,a)=>{var s;return t.id===(null===(s=e.footnotes[a])||void 0===s?void 0:s.id)})?t:e.footnotes),e.metadata&&Object.keys(e.metadata).length>0){var s,n;C(a={journalTitle:(s=e.metadata).journal||"Sample Journal",journalAbbrev:s.journalAbbrev,issn:s.issn,issnType:s.issnType||"print",publisher:s.publisher,publisherLocation:s.publisherLocation,articleTitle:s.title||"Generated Article",articleSubtitle:s.subtitle,articleType:s.articleType,authors:(null===(n=s.authors)||void 0===n?void 0:n.map(e=>({id:"author-".concat(Date.now(),"-").concat(Math.random()),surname:e.surname||"",givenNames:e.givenNames||"",prefix:e.prefix,suffix:e.suffix,email:e.email,orcid:e.orcid,affiliations:e.affiliations||[],corresp:e.corresp||!1})))||[],affiliations:s.affiliations||[],volume:s.volume,issue:s.issue,fpage:s.fpage,lpage:s.lpage,pubDay:s.pubDay,pubMonth:s.pubMonth,pubYear:s.pubYear,doi:s.doi,articleId:s.articleId,abstract:s.abstract,keywords:s.keywords||[],fundingStatement:s.fundingStatement,copyrightStatement:s.copyrightStatement,copyrightYear:s.copyrightYear,copyrightHolder:s.copyrightHolder,license:s.license,licenseUrl:s.licenseUrl,receivedDate:s.receivedDate,acceptedDate:s.acceptedDate,publishedDate:s.publishedDate}),console.log("✓ Front matter loaded from JATS file")}if(f){f.commands.setContent(e.content);let s=setTimeout(()=>{let s=f.getHTML(),n=R(s);u(e=>e.length!==n.length||e.some((e,t)=>{var a;return e.id!==(null===(a=n[t])||void 0===a?void 0:a.id)})?n:e),t(e=>e!==s?s:e);let r=B(s,e.references,e.footnotes,a);i(e=>e!==r?r:e),f.commands.focus()},100);return()=>clearTimeout(s)}v(!1)},[f,R,B]),G=(0,n.useCallback)(e=>{N(e),setTimeout(()=>{N(null)},100)},[]),_=(0,n.useCallback)(e=>{p(t=>t.some(t=>t.id===e.id)?t:[...t,e])},[]),K=(0,n.useCallback)((e,t)=>{p(a=>[...a.map(a=>{if(a.id===e){var s,n;return{...a,...t,id:a.id,type:null!==(s=t.type)&&void 0!==s?s:a.type,publicationType:null!==(n=t.publicationType)&&void 0!==n?n:a.publicationType}}return{...a}})])},[]),$=(0,n.useCallback)(e=>{p(t=>t.filter(t=>t.id!==e))},[]),Q=(0,n.useCallback)(e=>{g(t=>t.some(t=>t.id===e.id)?t:[...t,e])},[]),ee=(0,n.useCallback)((e,t)=>{g(a=>a.map(a=>a.id===e?{...a,content:t}:a))},[]),et=(0,n.useCallback)(e=>{g(t=>t.filter(t=>t.id!==e))},[]),ea=(0,n.useCallback)(t=>{C(t),i(B(e,h,x,t))},[e,h,x,B]),es=(0,n.useMemo)(()=>{if(!L.trim())return h;let e=L.toLowerCase();return h.filter(t=>{var a,s,n,r,l;if("element-citation"!==t.type)return null===(l=t.content)||void 0===l?void 0:l.toLowerCase().includes(e);{let l=null===(a=t.authors)||void 0===a?void 0:a.some(t=>t.surname.toLowerCase().includes(e)||t.givenNames.toLowerCase().includes(e)),i=null===(s=t.title)||void 0===s?void 0:s.toLowerCase().includes(e),o=null===(n=t.source)||void 0===n?void 0:n.toLowerCase().includes(e),c=null===(r=t.year)||void 0===r?void 0:r.includes(e);return l||i||o||c}})},[h,L]),en=(0,n.useMemo)(()=>{if(!z.trim())return x;let e=z.toLowerCase();return x.filter(t=>t.content.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))},[x,z]),er=(0,n.useCallback)(e=>{if(!f)return;let t=h.findIndex(t=>t.id===e);-1!==t&&(f.chain().focus().insertContent({type:"text",text:"[".concat(t+1,"]"),marks:[{type:"citation",attrs:{id:e,type:"bibr"}}]}).run(),T(!1),E(""))},[f,h]),el=(0,n.useCallback)(e=>{if(!f)return;let t=x.findIndex(t=>t.id===e);-1!==t&&(f.chain().focus().insertContent({type:"text",text:"[".concat(t+1,"]"),marks:[{type:"citation",attrs:{id:e,type:"fn"}}]}).run(),D(!1),I(""))},[f,x]);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(m,{showUpload:y,onToggleUpload:()=>v(!y),onOpenFrontMatter:()=>A(!0)}),(0,s.jsx)("div",{className:"fixed bottom-6 right-6 z-40",children:(0,s.jsxs)(d.z,{size:"lg",onClick:()=>A(!0),className:"shadow-lg",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5 mr-2"}),"Edit Front Matter"]})}),(0,s.jsx)("div",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-4",children:[y&&(0,s.jsx)(q,{onFileProcessed:W,onClose:()=>v(!1)}),(0,s.jsx)(eI,{references:h,footnotes:x,onContentChange:X,onHeadingsChange:F,onEditorReady:H,onUpdateReference:K,onDeleteReference:$,onUpdateFootnote:ee,onDeleteFootnote:et,onAddReference:_,onAddFootnote:Q,scrollToHeadingId:j,onOpenCitationSearch:()=>T(!0),onOpenFootnoteSearch:()=>D(!0),jatsXml:a})]}),(0,s.jsx)(eY,{editorInstance:f,jatsXml:a,references:h,footnotes:x,headings:c,validationResults:Z,onAddReference:_,onUpdateReference:K,onDeleteReference:$,onAddFootnote:Q,onUpdateFootnote:ee,onDeleteFootnote:et,onScrollToHeading:G})]})}),(0,s.jsx)(eW,{isOpen:S,onClose:()=>A(!1),onSave:ea,initialData:w}),k&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>e.target===e.currentTarget&&T(!1),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold flex items-center",children:[(0,s.jsx)(eS.Z,{className:"h-5 w-5 mr-2"}),"Insert Citation"]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>{T(!1),E("")},className:"h-8 w-8 p-0",children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(eS.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search by author, title, source, or year...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:L,onChange:e=>E(e.target.value),autoFocus:!0})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[es.length," of ",h.length," references"]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===es.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:0===h.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"mb-2",children:"No references available"}),(0,s.jsx)("p",{className:"text-sm",children:"Add references first to insert citations"})]}):(0,s.jsx)("p",{children:"No references match your search"})}):(0,s.jsx)("div",{className:"space-y-2",children:es.map(e=>{let t=h.findIndex(t=>t.id===e.id);return(0,s.jsx)("div",{className:"p-3 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition-all",onClick:()=>er(e.id),children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["[",t+1,"]"]}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600",children:"element-citation"===e.type?"Structured":"Mixed"}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-600",children:e.publicationType||"journal"})]}),"element-citation"===e.type?(0,s.jsxs)("div",{children:[e.title&&(0,s.jsx)("div",{className:"font-medium text-sm text-gray-900 mb-1",children:e.title}),e.authors&&e.authors.length>0&&(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:e.authors.filter(e=>e.surname||e.givenNames).map(e=>"".concat(e.surname).concat(e.givenNames?", "+e.givenNames:"")).join("; ")}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs text-gray-500",children:[e.source&&(0,s.jsx)("span",{children:e.source}),e.year&&(0,s.jsxs)("span",{children:["(",e.year,")"]}),e.volume&&(0,s.jsxs)("span",{children:["Vol. ",e.volume]}),e.issue&&(0,s.jsxs)("span",{children:["Issue ",e.issue]})]})]}):(0,s.jsx)("div",{className:"text-sm text-gray-900",children:e.content})]}),(0,s.jsx)(d.z,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),er(e.id)},children:"Insert"})]})},e.id)})})}),(0,s.jsx)("div",{className:"p-4 border-t bg-gray-50",children:(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Click on a reference to insert its citation at the cursor position"})})]})}),M&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>e.target===e.currentTarget&&D(!1),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold flex items-center",children:[(0,s.jsx)(eA.Z,{className:"h-5 w-5 mr-2"}),"Insert Footnote"]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>{D(!1),I("")},className:"h-8 w-8 p-0",children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(eS.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search footnotes by content or ID...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:z,onChange:e=>I(e.target.value),autoFocus:!0})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[en.length," of ",x.length," footnotes"]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===en.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:0===x.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"mb-2",children:"No footnotes available"}),(0,s.jsx)("p",{className:"text-sm",children:"Add footnotes first to insert them"})]}):(0,s.jsx)("p",{children:"No footnotes match your search"})}):(0,s.jsx)("div",{className:"space-y-2",children:en.map(e=>{let t=x.findIndex(t=>t.id===e.id);return(0,s.jsx)("div",{className:"p-3 border border-gray-200 rounded-lg hover:border-yellow-500 hover:bg-yellow-50 cursor-pointer transition-all",onClick:()=>el(e.id),children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:["[",t+1,"]"]}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["ID: ",e.id]})]}),(0,s.jsx)("div",{className:"text-sm text-gray-900 leading-relaxed",children:e.content})]}),(0,s.jsx)(d.z,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),el(e.id)},children:"Insert"})]})},e.id)})})}),(0,s.jsx)("div",{className:"p-4 border-t bg-gray-50",children:(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Click on a footnote to insert its citation at the cursor position"})})]})})]})}function eK(){return(0,s.jsx)(e_,{})}},9174:function(e,t,a){"use strict";a.d(t,{C:function(){return r}});var s=a(7437);a(2265);var n=a(3448);function r(e){let{className:t,variant:a="default",...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors",{default:"border-transparent bg-blue-600 text-white",secondary:"border-transparent bg-gray-200 text-gray-900",destructive:"border-transparent bg-red-600 text-white",outline:"text-gray-950 border-gray-200"}[a],t),...r})}},2381:function(e,t,a){"use strict";a.d(t,{z:function(){return l}});var s=a(7437),n=a(2265),r=a(3448);let l=n.forwardRef((e,t)=>{let{className:a,variant:n="default",size:l="default",...i}=e;return(0,s.jsx)("button",{className:(0,r.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 disabled:pointer-events-none disabled:opacity-50",{default:"bg-blue-600 text-white hover:bg-blue-700",outline:"border border-gray-300 bg-white hover:bg-gray-50",ghost:"hover:bg-gray-100",destructive:"bg-red-600 text-white hover:bg-red-700",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300"}[n],{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}[l],a),ref:t,...i})});l.displayName="Button"},9820:function(e,t,a){"use strict";a.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},ll:function(){return o}});var s=a(7437),n=a(2265),r=a(3448);let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-white text-gray-950 shadow-sm",a),...n})});l.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...n})});i.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...n})});o.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-gray-500",a),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",a),...n})});d.displayName="CardContent"},3448:function(e,t,a){"use strict";a.d(t,{cn:function(){return r}});var s=a(1994),n=a(3335);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,s.W)(t))}}},function(e){e.O(0,[572,902,140,896,971,117,744],function(){return e(e.s=7946)}),_N_E=e.O()}]);